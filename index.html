<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sanraksha - ASHA Support System</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Google Fonts: Inter for Professional Look -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* Slate 50 */
        }
        
        /* Custom Animations */
        @keyframes scan {
            0% { top: 0; }
            50% { top: 100%; }
            100% { top: 0; }
        }
        .animate-spin-slow {
            animation: spin 3s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .scan-line {
            position: absolute;
            width: 100%;
            height: 2px;
            background: #2dd4bf;
            box-shadow: 0 0 4px #2dd4bf;
            animation: scan 2s linear infinite;
        }
        
        /* Hide scrollbar */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* Camera Viewfinder Overlay */
        .camera-overlay {
            background: rgba(0,0,0,0.1);
            position: relative;
        }
        .camera-overlay::after {
            content: '';
            position: absolute;
            top: 20%;
            left: 20%;
            right: 20%;
            bottom: 20%;
            border: 2px dashed rgba(255,255,255,0.7);
            border-radius: 12px;
        }
        
        /* Audio Wave Animation */
        .bar {
            width: 4px;
            background: #4f46e5;
            animation: wave 1s ease-in-out infinite;
        }
        @keyframes wave {
            0%, 100% { height: 10px; }
            50% { height: 24px; }
        }

        /* Confetti Animation for Sim Lab */
        @keyframes pop {
            0% { transform: scale(0.8); opacity: 0; }
            50% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }
        .pop-in {
            animation: pop 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }
        
        /* Pulse Animation for Emergency */
        @keyframes pulse-red {
            0% { box-shadow: 0 0 0 0 rgba(225, 29, 72, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(225, 29, 72, 0); }
            100% { box-shadow: 0 0 0 0 rgba(225, 29, 72, 0); }
        }
        .animate-pulse-red {
            animation: pulse-red 2s infinite;
        }

        /* Float Animation */
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-8px); }
            100% { transform: translateY(0px); }
        }
        .animate-float {
            animation: float 4s ease-in-out infinite;
        }

        /* Heartbeat Animation */
        @keyframes heartbeat {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        .animate-heartbeat {
            animation: heartbeat 1.5s ease-in-out infinite;
        }
    </style>
</head>
<body class="bg-slate-50 h-screen w-full overflow-hidden select-none text-slate-800">
    <div id="root" class="h-full w-full"></div>

    <script type="text/babel">
        // --- ICON BRIDGE ---
        const LucideIcons = Object.keys(lucide.icons).reduce((acc, iconName) => {
            acc[iconName] = ({ size = 20, className = "", ...props }) => {
                const iconDef = lucide.icons[iconName];
                if (!iconDef) return null;
                const children = iconDef.map(([tag, attrs], i) => (
                    React.createElement(tag, { ...attrs, key: i })
                ));
                return React.createElement('svg', {
                    ...props,
                    xmlns: "http://www.w3.org/2000/svg",
                    width: size,
                    height: size,
                    viewBox: "0 0 24 24",
                    fill: "none",
                    stroke: "currentColor",
                    strokeWidth: 2,
                    strokeLinecap: "round",
                    strokeLinejoin: "round",
                    className: className
                }, children);
            };
            return acc;
        }, {});

        const { 
            Volume2, Check, AlertTriangle, ChevronRight, Menu, Save, Activity, Phone, Plus, Users, 
            Calendar, Sparkles, X, MessageCircle, ArrowLeft, Heart, Mic, Send, Award, TrendingUp, 
            DownloadCloud, BookOpen, LogOut, UserCircle, QrCode, ShieldCheck, MapPin, Clock, FileText, 
            StopCircle, Scan, Lock, ArrowRight, KeyRound, Search, Filter, Stethoscope, Siren, Edit, 
            Bell, PieChart, BarChart2, Globe, Landmark, Wifi, WifiOff, Cloud, CloudOff, RefreshCw, 
            Info, Bluetooth, Truck, Package, Syringe, ClipboardList, Ambulance, Link, PlayCircle, 
            Video, Gamepad2, GraduationCap, Star, Headphones, Wallet, Banknote, CreditCard, CheckCircle, 
            ShieldAlert, FileBadge, Megaphone, HeartHandshake, Baby, Briefcase, Umbrella, Droplet,
            LayoutDashboard, FilePlus, Settings, LogIn, Camera, Speaker, Database, Lightbulb, Smartphone,
            CalendarClock, Trophy, BadgeIndianRupee, IndianRupee, PhoneCall, FileWarning, Eye, EyeOff
        } = LucideIcons;

        const { useState, useEffect, useRef } = React;

        // --- TRANSLATION DICTIONARY ---
        const TRANSLATIONS = {
            // General
            'Dashboard': { hi: '‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§°' },
            'Sanraksha': { hi: '‡§∏‡§Ç‡§∞‡§ï‡•ç‡§∑‡§æ' },
            'Professional Care System': { hi: '‡§™‡•á‡§∂‡•á‡§µ‡§∞ ‡§¶‡•á‡§ñ‡§≠‡§æ‡§≤ ‡§™‡•ç‡§∞‡§£‡§æ‡§≤‡•Ä' },
            'Secure Login': { hi: '‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§≤‡•â‡§ó‡§ø‡§®' },
            'Mobile Number': { hi: '‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞' },
            'Login': { hi: '‡§≤‡•â‡§ó‡§ø‡§®' },
            'Synced': { hi: '‡§∏‡§ø‡§Ç‡§ï‡•ç‡§°' },
            'Offline': { hi: '‡§ë‡§´‡§≤‡§æ‡§á‡§®' },
            'Search patients...': { hi: '‡§Æ‡§∞‡•Ä‡§ú ‡§ñ‡•ã‡§ú‡•á‡§Ç...' },
            'Quick Actions': { hi: '‡§§‡•ç‡§µ‡§∞‡§ø‡§§ ‡§ï‡§æ‡§∞‡•ç‡§Ø' },
            
            // Dashboard Cards
            'Total Cases': { hi: '‡§ï‡•Å‡§≤ ‡§Æ‡§æ‡§Æ‡§≤‡•á' },
            'High Risk': { hi: '‡§π‡§æ‡§à ‡§∞‡§ø‡§∏‡•ç‡§ï' },
            'Anemic': { hi: '‡§è‡§®‡•Ä‡§Æ‡§ø‡§ï' },
            'Recent Outcomes': { hi: '‡§π‡§æ‡§≤ ‡§ï‡•á ‡§™‡§∞‡§ø‡§£‡§æ‡§Æ' },
            
            // Actions
            'New Reg.': { hi: '‡§™‡§Ç‡§ú‡•Ä‡§ï‡§∞‡§£' },
            'Scan QR': { hi: 'QR ‡§∏‡•ç‡§ï‡•à‡§®' },
            'Inventory': { hi: '‡§∏‡•ç‡§ü‡•â‡§ï' },
            'Training': { hi: '‡§™‡•ç‡§∞‡§∂‡§ø‡§ï‡•ç‡§∑‡§£' },
            'Academy': { hi: '‡§Ö‡§ï‡§æ‡§¶‡§Æ‡•Ä' },
            
            // Inventory
            'Medical Inventory': { hi: '‡§ö‡§ø‡§ï‡§ø‡§§‡•ç‡§∏‡§æ ‡§≠‡§Ç‡§°‡§æ‡§∞' },
            'remaining': { hi: '‡§∂‡•á‡§∑' },
            'Low Stock': { hi: '‡§ï‡§Æ ‡§∏‡•ç‡§ü‡•â‡§ï' },
            'Order Now': { hi: '‡§ë‡§∞‡•ç‡§°‡§∞ ‡§ï‡§∞‡•á‡§Ç' },
            'Ordered': { hi: '‡§ë‡§∞‡•ç‡§°‡§∞ ‡§ï‡§ø‡§Ø‡§æ' },
            
            // Registration
            'New Registration': { hi: '‡§®‡§Ø‡§æ ‡§™‡§Ç‡§ú‡•Ä‡§ï‡§∞‡§£' },
            'Single Source Data': { hi: '‡§è‡§ï‡§≤ ‡§∏‡•ç‡§∞‡•ã‡§§ ‡§°‡•á‡§ü‡§æ' },
            'Full Name': { hi: '‡§™‡•Ç‡§∞‡§æ ‡§®‡§æ‡§Æ' },
            'Age': { hi: '‡§â‡§Æ‡•ç‡§∞' },
            'Weeks': { hi: '‡§∏‡§™‡•ç‡§§‡§æ‡§π' },
            'Phone': { hi: '‡§´‡•ã‡§®' },
            'Village': { hi: '‡§ó‡§æ‡§Å‡§µ' },
            'Vitals': { hi: '‡§µ‡§æ‡§á‡§ü‡§≤‡•ç‡§∏' },
            'Sync Device': { hi: '‡§∏‡§ø‡§Ç‡§ï ‡§°‡§ø‡§µ‡§æ‡§á‡§∏' },
            'Save & Sync': { hi: '‡§∏‡•á‡§µ ‡§î‡§∞ ‡§∏‡§ø‡§Ç‡§ï' },
            
            // Patient Profile
            'Patient Profile': { hi: '‡§Æ‡§∞‡•Ä‡§ú ‡§™‡•ç‡§∞‡•ã‡§´‡§æ‡§á‡§≤' },
            'Obstetric History': { hi: '‡§™‡•ç‡§∞‡§∏‡•Ç‡§§‡§ø ‡§á‡§§‡§ø‡§π‡§æ‡§∏' },
            'Counseling & Job Aids': { hi: '‡§ï‡§æ‡§â‡§Ç‡§∏‡§≤‡§ø‡§Ç‡§ó ‡§î‡§∞ ‡§ú‡•â‡§¨ ‡§è‡§°‡•ç‡§∏' },
            'Start Checkup': { hi: '‡§ú‡§æ‡§Ç‡§ö ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç' },
            'Emergency Referral': { hi: '‡§Ü‡§™‡§æ‡§§‡§ï‡§æ‡§≤‡•Ä‡§® ‡§∞‡•á‡§´‡§∞‡§≤' },
            'Hemoglobin Trend (Weeks vs g/dL)': { hi: '‡§π‡•Ä‡§Æ‡•ã‡§ó‡•ç‡§≤‡•ã‡§¨‡§ø‡§® ‡§ü‡•ç‡§∞‡•á‡§Ç‡§°' },
            
            // Training
            'ASHA Academy': { hi: '‡§Ü‡§∂‡§æ ‡§Ö‡§ï‡§æ‡§¶‡§Æ‡•Ä' },
            'Learn, Practice, and Master your skills.': { hi: '‡§∏‡•Ä‡§ñ‡•á‡§Ç, ‡§Ö‡§≠‡•ç‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§®‡§ø‡§™‡•Å‡§£ ‡§¨‡§®‡•á‡§Ç‡•§' },
            'Learn': { hi: '‡§∏‡•Ä‡§ñ‡•á‡§Ç' },
            'ECHO Live': { hi: '‡§à‡§ï‡•ã ‡§≤‡§æ‡§á‡§µ' },
            'Sim Lab': { hi: '‡§∏‡§ø‡§Æ ‡§≤‡•à‡§¨' },
            'ECHO Hub': { hi: '‡§à‡§ï‡•ã ‡§π‡§¨' },
            'Daily Challenge': { hi: '‡§¶‡•à‡§®‡§ø‡§ï ‡§ö‡•Å‡§®‡•å‡§§‡•Ä' },
            
            // Finance
            'Finance Hub': { hi: '‡§µ‡§ø‡§§‡•ç‡§§ ‡§ï‡•á‡§Ç‡§¶‡•ç‡§∞' },
            'Track your earnings and benefits': { hi: '‡§Ö‡§™‡§®‡•Ä ‡§ï‡§Æ‡§æ‡§à ‡§î‡§∞ ‡§≤‡§æ‡§≠ ‡§ü‡•ç‡§∞‡•à‡§ï ‡§ï‡§∞‡•á‡§Ç' },
            'Ledger': { hi: '‡§ñ‡§æ‡§§‡§æ' },
            'Salary': { hi: '‡§µ‡•á‡§§‡§®' },
            'Benefits': { hi: '‡§≤‡§æ‡§≠' },
            'Total Earnings': { hi: '‡§ï‡•Å‡§≤ ‡§ï‡§Æ‡§æ‡§à' },
            'Fixed Honorarium': { hi: '‡§®‡§ø‡§∂‡•ç‡§ö‡§ø‡§§ ‡§Æ‡§æ‡§®‡§¶‡•á‡§Ø' },
            'Performance Incentives': { hi: '‡§™‡•ç‡§∞‡§¶‡§∞‡•ç‡§∂‡§® ‡§™‡•ç‡§∞‡•ã‡§§‡•ç‡§∏‡§æ‡§π‡§®' },
            'Download Slip': { hi: '‡§∏‡•ç‡§≤‡§ø‡§™ ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç' },
            
            // Safety
            'ASHA Sahayata (Safety)': { hi: '‡§Ü‡§∂‡§æ ‡§∏‡§π‡§æ‡§Ø‡§§‡§æ (‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ)' },
            'Safety Hub': { hi: '‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ ‡§ï‡•á‡§Ç‡§¶‡•ç‡§∞' },
            'Your safety is our priority.': { hi: '‡§Ü‡§™‡§ï‡•Ä ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ ‡§π‡§Æ‡§æ‡§∞‡•Ä ‡§™‡•ç‡§∞‡§æ‡§•‡§Æ‡§ø‡§ï‡§§‡§æ ‡§π‡•à‡•§' },
            'Emergency Dial': { hi: '‡§Ü‡§™‡§æ‡§§‡§ï‡§æ‡§≤‡•Ä‡§® ‡§ï‡•â‡§≤' },
            'Women Line': { hi: '‡§Æ‡§π‡§ø‡§≤‡§æ ‡§π‡•á‡§≤‡•ç‡§™‡§≤‡§æ‡§á‡§®' },
            'Med. Officer': { hi: '‡§ö‡§ø‡§ï‡§ø‡§§‡•ç‡§∏‡§æ ‡§Ö‡§ß‡§ø‡§ï‡§æ‡§∞‡•Ä' },
            'Call Now': { hi: '‡§ï‡•â‡§≤ ‡§ï‡§∞‡•á‡§Ç' },
            'Peer Network (Buddy System)': { hi: '‡§∏‡§æ‡§•‡•Ä ‡§®‡•á‡§ü‡§µ‡§∞‡•ç‡§ï' },
            'Request Visit': { hi: '‡§Æ‡§¶‡§¶ ‡§Æ‡§æ‡§Ç‡§ó‡•á‡§Ç' },
            'Anonymous Reporting': { hi: '‡§ó‡•Å‡§Æ‡§®‡§æ‡§Æ ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü‡§ø‡§Ç‡§ó' },
            'Submit Report': { hi: '‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§≠‡•á‡§ú‡•á‡§Ç' },
            
            // Referral
            'Referral': { hi: '‡§∞‡•á‡§´‡§∞‡§≤' },
            'High Risk Protocol Activated': { hi: '‡§π‡§æ‡§à ‡§∞‡§ø‡§∏‡•ç‡§ï ‡§™‡•ç‡§∞‡•ã‡§ü‡•ã‡§ï‡•â‡§≤ ‡§∏‡§ï‡•ç‡§∞‡§ø‡§Ø' },
            'Referral ID': { hi: '‡§∞‡•á‡§´‡§∞‡§≤ ‡§Ü‡§à‡§°‡•Ä' },
            'PHC Alerted': { hi: 'PHC ‡§∏‡•Ç‡§ö‡§ø‡§§' },
            'Back to Home': { hi: '‡§π‡•ã‡§Æ ‡§™‡§∞ ‡§ú‡§æ‡§è‡§Ç' },
            'Dispatch Confirmed (5 mins away)': { hi: '‡§°‡§ø‡§∏‡•ç‡§™‡•à‡§ö ‡§ï‡•Ä ‡§™‡•Å‡§∑‡•ç‡§ü‡§ø (5 ‡§Æ‡§ø‡§®‡§ü ‡§¶‡•Ç‡§∞)' },
            'Waiting...': { hi: '‡§™‡•ç‡§∞‡§§‡•Ä‡§ï‡•ç‡§∑‡§æ...' },
            'Connecting to network...': { hi: '‡§®‡•á‡§ü‡§µ‡§∞‡•ç‡§ï ‡§∏‡•á ‡§ú‡•Å‡§°‡§º ‡§∞‡§π‡§æ ‡§π‡•à...' },
            
            // Notifications
            'Notifications': { hi: '‡§∏‡•Ç‡§ö‡§®‡§æ‡§è‡§Ç' },
            'Clear All': { hi: '‡§∏‡§≠‡•Ä ‡§π‡§ü‡§æ‡§è‡§Ç' },
            
            // Branding
            'National Health Mission': { hi: '‡§∞‡§æ‡§∑‡•ç‡§ü‡•ç‡§∞‡•Ä‡§Ø ‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø ‡§Æ‡§ø‡§∂‡§®' },
            'Digital India': { hi: '‡§°‡§ø‡§ú‡§ø‡§ü‡§≤ ‡§á‡§Ç‡§°‡§ø‡§Ø‡§æ' },
            
            // Sidebar
            'My Earnings & Benefits': { hi: '‡§Æ‡•á‡§∞‡•Ä ‡§ï‡§Æ‡§æ‡§à ‡§î‡§∞ ‡§≤‡§æ‡§≠' },
            'Performance Report': { hi: '‡§™‡•ç‡§∞‡§¶‡§∞‡•ç‡§∂‡§® ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü' },
            'Settings': { hi: '‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§∏' },
            'Logout': { hi: '‡§≤‡•â‡§ó ‡§Ü‡§â‡§ü' },
            
            // Assessment
            'Save Assessment': { hi: '‡§Ü‡§ï‡§≤‡§® ‡§∏‡•á‡§µ ‡§ï‡§∞‡•á‡§Ç' },
            'Algorithm Recommendation': { hi: '‡§è‡§≤‡•ç‡§ó‡•ã‡§∞‡§ø‡§¶‡§Æ ‡§∏‡•Å‡§ù‡§æ‡§µ' },
            'Play Doctor\'s Message': { hi: '‡§°‡•â‡§ï‡•ç‡§ü‡§∞ ‡§ï‡§æ ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§∏‡•Å‡§®‡•á‡§Ç' },

            // Login & Reset
            'Send OTP': { hi: 'OTP ‡§≠‡•á‡§ú‡•á‡§Ç' },
            'Enter OTP': { hi: 'OTP ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç' },
            'Verify & Login': { hi: '‡§∏‡§§‡•ç‡§Ø‡§æ‡§™‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡§∞‡•á‡§Ç' },
            'Forgot PIN?': { hi: '‡§™‡§ø‡§® ‡§≠‡•Ç‡§≤ ‡§ó‡§è?' },
            'Reset PIN': { hi: '‡§™‡§ø‡§® ‡§∞‡•Ä‡§∏‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç' },
            'New PIN': { hi: '‡§®‡§Ø‡§æ ‡§™‡§ø‡§®' },
            'Reset Password': { hi: '‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§∞‡•Ä‡§∏‡•á‡§ü' },
            'Resend': { hi: '‡§™‡•Å‡§®‡§É ‡§≠‡•á‡§ú‡•á‡§Ç' },
            'Confirm New PIN': { hi: '‡§®‡§Ø‡§æ ‡§™‡§ø‡§® ‡§™‡•Å‡§∑‡•ç‡§ü‡§ø ‡§ï‡§∞‡•á‡§Ç' },
            'Back to Login': { hi: '‡§≤‡•â‡§ó‡§ø‡§® ‡§™‡§∞ ‡§µ‡§æ‡§™‡§∏ ‡§ú‡§æ‡§è‡§Ç' },
            'ASHA ID': { hi: '‡§Ü‡§∂‡§æ ‡§Ü‡§à‡§°‡•Ä' },
            'PIN': { hi: '‡§™‡§ø‡§®' }
        };

        // --- CONSTANTS & DATA ---
        const RISK_WEIGHTS = {
            ANAEMIA: 20, EDEMA: 15, HTN: 25, BLEEDING: 25, PAIN: 20,
            CONTRACTIONS: 30, FEVER: 15, MENTAL: 10, AGE_RISK: 5
        };

        const ANAEMIA_SCALE = [
            { id: 'optimal', label: '1. Optimal', sub: 'No Dose', color: '#8B0000', textColor: 'white', risk: 0 },
            { id: 'acceptable', label: '2. Acceptable', sub: 'No Dose', color: '#D32F2F', textColor: 'white', risk: 0 },
            { id: 'borderline', label: '3. Borderline', sub: 'Dose?', color: '#EF5350', textColor: 'white', risk: 15 },
            { id: 'dangerous', label: '4. Dangerous', sub: 'Dose!', color: '#FFCDD2', textColor: '#880e4f', risk: 25 },
            { id: 'fatal', label: '5. Fatal', sub: 'Dose!', color: '#FFEBEE', textColor: '#880e4f', risk: 35 }
        ];

        const SYMPTOM_CHECKLIST = [
            { id: 'anaemia_symptom', weight: 0, hi: '‡§ï‡•ç‡§Ø‡§æ ‡§¨‡§π‡•Å‡§§ ‡§•‡§ï‡§æ‡§µ‡§ü ‡§π‡•à? ‡§Ø‡§æ ‡§∏‡§æ‡§Ç‡§∏ ‡§´‡•Ç‡§≤ ‡§∞‡§π‡•Ä ‡§π‡•à?', en: 'Extreme fatigue? Shortness of breath?', icon: 'üò´', guide: 'Ask: "Can you walk up stairs without stopping?"' },
            { id: 'edema', weight: RISK_WEIGHTS.EDEMA, hi: '‡§™‡•à‡§∞, ‡§π‡§æ‡§• ‡§Ø‡§æ ‡§ö‡•á‡§π‡§∞‡•á ‡§Æ‡•á‡§Ç ‡§∏‡•Ç‡§ú‡§® ‡§π‡•à?', en: 'Swelling in feet, hands, or face?', icon: 'ü¶∂', guide: 'Action: Press thumb on shin bone for 5 seconds. If pit remains, select Yes.' },
            { id: 'htn', weight: RISK_WEIGHTS.HTN, hi: '‡§∏‡§ø‡§∞ ‡§Æ‡•á‡§Ç ‡§¶‡§∞‡•ç‡§¶ ‡§π‡•à? ‡§Ü‡§Å‡§ñ‡•ã‡§Ç ‡§ï‡•á ‡§∏‡§æ‡§Æ‡§®‡•á ‡§Ö‡§Ç‡§ß‡•á‡§∞‡§æ ‡§Ü‡§§‡§æ ‡§π‡•à?', en: 'Severe headache? Dark spots before eyes?', icon: 'ü§ï', guide: 'Check BP immediately. If >140/90, select Yes.' },
            { id: 'bleeding', weight: RISK_WEIGHTS.BLEEDING, hi: '‡§ï‡•ç‡§Ø‡§æ ‡§¨‡•ç‡§≤‡•Ä‡§°‡§ø‡§Ç‡§ó ‡§Ø‡§æ ‡§°‡§ø‡§∏‡•ç‡§ö‡§æ‡§∞‡•ç‡§ú ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à?', en: 'Vaginal bleeding or discharge?', icon: 'ü©∏', critical: true, guide: 'Ask about pad usage. Any soaking is critical.' },
            { id: 'pain', weight: RISK_WEIGHTS.PAIN, hi: '‡§™‡•á‡§ü ‡§Æ‡•á‡§Ç ‡§§‡•á‡§ú ‡§¶‡§∞‡•ç‡§¶ ‡§Ø‡§æ ‡§ê‡§Ç‡§†‡§® ‡§π‡•à?', en: 'Severe abdominal pain or cramping?', icon: 'ü§∞', guide: 'Touch abdomen. If hard or very tender, select Yes.' },
            { id: 'contractions', weight: RISK_WEIGHTS.CONTRACTIONS, hi: '‡§ï‡•ç‡§Ø‡§æ ‡§∞‡•Å‡§ï-‡§∞‡•Å‡§ï ‡§ï‡§∞ ‡§¶‡§∞‡•ç‡§¶ (contractions) ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à?', en: 'Having regular contractions?', icon: '‚è±Ô∏è', critical: true, guide: 'Time it: More than 2 pains in 10 minutes?' },
            { id: 'fever', weight: RISK_WEIGHTS.FEVER, hi: '‡§¨‡•Å‡§ñ‡§æ‡§∞ ‡§π‡•à? ‡§™‡•á‡§∂‡§æ‡§¨ ‡§Æ‡•á‡§Ç ‡§ú‡§≤‡§® ‡§π‡•à?', en: 'Fever? Burning urination?', icon: 'üå°Ô∏è', guide: 'Check temperature with thermometer. Look for dark urine.' },
            { id: 'mental', weight: RISK_WEIGHTS.MENTAL, hi: '‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§¨‡§π‡•Å‡§§ ‡§§‡§®‡§æ‡§µ ‡§Ø‡§æ ‡§Ö‡§ï‡•á‡§≤‡§æ‡§™‡§® ‡§Æ‡§π‡§∏‡•Ç‡§∏ ‡§ï‡§∞ ‡§∞‡§π‡•Ä ‡§π‡•à‡§Ç?', en: 'Feeling very stressed or alone?', icon: 'üß†', guide: 'Observation: Is she crying or very silent? Ask about sleep.' }
        ];
        
        const DOCTOR_MESSAGES = {
            GREEN: { text: "Namaste. The patient is healthy. Please ensure she continues a nutritious diet and rests well.", type: "Routine" },
            YELLOW: { text: "Namaste. I am Dr. Sharma. There are some minor concerns. Please ensure she takes her iron tablets daily.", type: "Caution" },
            ORANGE: { text: "Namaste. I am Dr. Sharma. The patient is at high risk. It is important to visit the health center within 3 days for a checkup.", type: "Medical Alert" },
            RED: { text: "Urgent! I am Dr. Sharma, Chief Medical Officer. This is a medical emergency. You must take the patient to the hospital immediately to save her life. Do not delay.", type: "Emergency Order" }
        };

        const INITIAL_INVENTORY = {
            ifa: { id: 'ifa', name: 'IFA Red Tablets', count: 40, unit: 'strips', min: 50, status: 'low' },
            calc: { id: 'calc', name: 'Calcium Tablets', count: 80, unit: 'strips', min: 40, status: 'ok' },
            kit: { id: 'kit', name: 'Pregnancy Test Kits', count: 2, unit: 'kits', min: 5, status: 'low' },
            ors: { id: 'ors', name: 'ORS Packets', count: 45, unit: 'packets', min: 20, status: 'ok' }
        };

        const JOB_AIDS = [
            { id: 1, title: "Nutrition Guide", desc: "For Anemic Mothers", type: "Audio", duration: "2:00" },
            { id: 2, title: "Danger Signs", desc: "When to call 108", type: "Video", duration: "3:45" },
            { id: 3, title: "Birth Prep", desc: "Hospital Bag List", type: "Checklist", duration: "1:00" },
        ];
        
        const ECHO_SESSIONS = [
            { id: 1, title: "High-Risk Pregnancy Protocols", doctor: "Dr. A. Gupta", time: "Today, 4:00 PM", status: "live" },
            { id: 2, title: "Neonatal Resuscitation", doctor: "Dr. S. Khan", time: "Tomorrow, 2:00 PM", status: "upcoming" }
        ];
        
        const FINANCE_DATA = {
            ledger: [
                { id: 1, desc: "New Pregnancy Reg (Suman)", date: "25 Oct", amount: 150, status: "pending" },
                { id: 2, desc: "Full Immunization (Rohan)", date: "20 Oct", amount: 200, status: "credited" },
                { id: 3, desc: "JSY Escort Service", date: "15 Oct", amount: 600, status: "credited" }
            ],
            salary: {
                honorarium: 4500,
                incentives: 2150,
                total: 6650,
                month: "October 2025"
            },
            benefits: [
                { name: "PM Jeevan Jyoti Bima", status: "Active", renewal: "May 2026" },
                { name: "PM Suraksha Bima", status: "Active", renewal: "May 2026" },
                { name: "Yogi Man Dhan (Pension)", status: "Active", renewal: "Auto-debit" }
            ]
        };
        
        const PEER_NETWORK = [
            { id: 1, name: "Sunita Devi", distance: "0.5 km", status: "Active", phone: "9876598765" },
            { id: 2, name: "Anita Singh", distance: "1.2 km", status: "Active", phone: "9123456789" },
            { id: 3, name: "Pooja Verma", distance: "2.0 km", status: "Busy", phone: "9988776655" }
        ];

        const INITIAL_MOTHERS = [
            { 
                id: 101, name: "Suman", age: 24, weeks: 29, lastVisit: "2 days ago", image: "SU", history: "G1P0", village: "Malviya Nagar", address: "Malviya Nagar", phone: "09236096068", risk: "high", anemia: "severe", dob: "N/A", lmp: "2025-05-22", edd: "2026-02-21", weight: "54", bp: "100/70", hemoglobin: "6.5",
                hbHistory: [ {w: 12, hb: 8.5}, {w: 20, hb: 7.8}, {w: 24, hb: 7.2}, {w: 29, hb: 6.5} ]
            },
            { 
                id: 1, name: "Seema Devi", age: 28, weeks: 30, lastVisit: "3 days ago", image: "SD", history: "G3P2L2", village: "Nandgaon", phone: "9876543210", risk: "high", anemia: "severe", address: "House 22, Nandgaon", lmp: "2025-04-10", edd: "2026-01-15", weight: "52", bp: "120/80", hemoglobin: "9.2",
                hbHistory: [ {w: 12, hb: 10.5}, {w: 20, hb: 9.8}, {w: 28, hb: 9.2} ]
            },
            { 
                id: 2, name: "Priya Sharma", age: 17, weeks: 32, lastVisit: "10 days ago", image: "PS", history: "G1P0", village: "Sonbardi", phone: "9876543211", risk: "low", anemia: "none", address: "Near Well, Sonbardi", lmp: "2025-03-25", edd: "2025-12-30", weight: "48", bp: "110/70", hemoglobin: "11.5",
                hbHistory: [ {w: 12, hb: 12.0}, {w: 24, hb: 11.8}, {w: 32, hb: 11.5} ]
            },
        ];

        const OUTCOMES = [
            { id: 1, text: "Safe Delivery: Smt. Anju (Boy, 2.8kg)", time: "2 hrs ago", type: "success" },
            { id: 2, text: "Referral: Geeta reached District Hospital", time: "5 hrs ago", type: "info" }
        ];
        
        const INITIAL_NOTIFICATIONS = [
            { id: 1, type: 'alert', title: 'Low Stock Alert', msg: 'IFA Red Tablets below minimum (40 strips).', time: '10 mins ago' },
            { id: 2, type: 'credit', title: 'Incentive Credited', msg: '‚Çπ200 for Immunization (Rohan).', time: '1 hr ago' },
            { id: 3, type: 'info', title: 'Outcome Update', msg: 'Safe delivery reported for Smt. Anju.', time: '2 hrs ago' }
        ];

        const apiKey = "AIzaSyCE6m0imIFy8H1pkM9iOXa2cLFP2_XA8CQ"; 

        // --- API HELPERS ---
        const callGeminiText = async (prompt) => {
            try {
                const response = await fetch(
                `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`,
                { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] }) }
                );
                if (!response.ok) throw new Error("API call failed");
                const data = await response.json();
                return data.candidates?.[0]?.content?.parts?.[0]?.text || "Error generating response.";
            } catch (e) { return "Error: Could not connect to AI service."; }
        };

        // --- COMPONENTS ---
        
        const SimpleLineChart = ({ data, t }) => {
            if (!data || data.length === 0) return null;
            
            const width = 300;
            const height = 150;
            const padding = 20;
            
            // Scaling
            const maxW = Math.max(...data.map(d => d.w), 40);
            const minW = Math.min(...data.map(d => d.w), 0);
            const maxHb = 14; 
            const minHb = 5;

            const xScale = (w) => padding + ((w - minW) / (maxW - minW)) * (width - 2 * padding);
            const yScale = (hb) => height - padding - ((hb - minHb) / (maxHb - minHb)) * (height - 2 * padding);

            const points = data.map(d => `${xScale(d.w)},${yScale(d.hb)}`).join(' ');

            return (
                <div className="w-full overflow-hidden bg-white p-2 rounded-lg border border-slate-100 shadow-sm">
                    <h4 className="text-xs font-bold text-slate-500 uppercase mb-2">{t('Hemoglobin Trend (Weeks vs g/dL)')}</h4>
                    <svg width="100%" height={height} viewBox={`0 0 ${width} ${height}`}>
                        <line x1={padding} y1={yScale(11)} x2={width-padding} y2={yScale(11)} stroke="#10b981" strokeWidth="1" strokeDasharray="4" opacity="0.5"/>
                        <text x={width-padding} y={yScale(11)-2} fontSize="10" fill="#10b981" textAnchor="end">Target (11)</text>
                        <line x1={padding} y1={yScale(7)} x2={width-padding} y2={yScale(7)} stroke="#e11d48" strokeWidth="1" strokeDasharray="4" opacity="0.5"/>
                        <text x={width-padding} y={yScale(7)-2} fontSize="10" fill="#e11d48" textAnchor="end">Severe (7)</text>
                        <line x1={padding} y1={height-padding} x2={width-padding} y2={height-padding} stroke="#cbd5e1" strokeWidth="1"/>
                        <line x1={padding} y1={padding} x2={padding} y2={height-padding} stroke="#cbd5e1" strokeWidth="1"/>
                        <polyline points={points} fill="none" stroke="#4f46e5" strokeWidth="2" />
                        {data.map((d, i) => (
                            <circle key={i} cx={xScale(d.w)} cy={yScale(d.hb)} r="3" fill="#4f46e5" />
                        ))}
                    </svg>
                </div>
            );
        };

        const AskDidiModal = ({ isOpen, onClose, lang }) => {
            const [query, setQuery] = useState("");
            const [response, setResponse] = useState("");
            const [loading, setLoading] = useState(false);
            const [isListening, setIsListening] = useState(false);

            const handleAsk = async () => {
                if (!query.trim()) return;
                setLoading(true);
                setResponse("");
                const prompt = `Act as a senior ASHA trainer. User asks: "${query}". Answer in simple ${lang === 'hi' ? 'Hindi' : 'English'}. Keep it medical but simple. Max 50 words.`;
                const res = await callGeminiText(prompt);
                setResponse(res);
                setLoading(false);
            };

            const simulateVoiceInput = () => {
                setIsListening(true);
                setTimeout(() => {
                    setQuery(lang === 'hi' ? "‡§ó‡§∞‡•ç‡§≠‡§µ‡§§‡•Ä ‡§Æ‡§π‡§ø‡§≤‡§æ ‡§ï‡•ã ‡§ï‡•ç‡§Ø‡§æ ‡§ñ‡§æ‡§®‡§æ ‡§ö‡§æ‡§π‡§ø‡§è?" : "What should a pregnant woman eat?");
                    setIsListening(false);
                }, 2000);
            };

            if (!isOpen) return null;

            return (
                <div className="fixed inset-0 bg-slate-900/40 z-50 flex items-center justify-center p-4 backdrop-blur-sm animate-in fade-in">
                    <div className="bg-white w-full max-w-sm rounded-lg shadow-xl overflow-hidden flex flex-col h-[600px] border border-slate-200">
                        <div className="bg-slate-800 p-4 flex justify-between items-center text-white">
                            <div className="flex items-center gap-2 font-medium">
                                <Sparkles size={16} className="text-teal-400"/> 
                                <span>Sanraksha Assistant</span>
                            </div>
                            <button onClick={onClose}><X size={20} className="text-slate-400 hover:text-white"/></button>
                        </div>
                        <div className="flex-1 bg-slate-50 p-4 overflow-y-auto">
                             <div className="flex flex-col gap-4">
                                <div className="self-start bg-white p-3 rounded-lg rounded-tl-none shadow-sm border border-slate-200 max-w-[85%]">
                                    <p className="text-sm text-slate-700">Namaste! I am your AI assistant. Tap the mic to ask questions.</p>
                                </div>
                                {query && (
                                    <div className="self-end bg-teal-100 p-3 rounded-lg rounded-tr-none shadow-sm border border-teal-200 max-w-[85%]">
                                        <p className="text-sm text-teal-900">{query}</p>
                                    </div>
                                )}
                                {(loading || isListening) && (
                                    <div className="self-start bg-white p-3 rounded-lg rounded-tl-none shadow-sm border border-slate-200">
                                        <div className="flex gap-1 items-center">
                                            {isListening ? <Mic size={16} className="animate-pulse text-red-500"/> : null}
                                            <div className="w-2 h-2 bg-slate-400 rounded-full animate-bounce"></div>
                                            <div className="w-2 h-2 bg-slate-400 rounded-full animate-bounce delay-75"></div>
                                            <div className="w-2 h-2 bg-slate-400 rounded-full animate-bounce delay-150"></div>
                                        </div>
                                    </div>
                                )}
                                {response && (
                                    <div className="self-start bg-white p-3 rounded-lg rounded-tl-none shadow-sm border border-slate-200 max-w-[85%]">
                                        <p className="text-sm text-slate-700">{response}</p>
                                    </div>
                                )}
                             </div>
                        </div>
                        <div className="p-3 bg-white border-t border-slate-200">
                            <div className="flex gap-2 items-center">
                                <button onClick={simulateVoiceInput} className="p-2.5 bg-slate-100 rounded-full text-slate-600 hover:bg-slate-200 active:bg-red-100 active:text-red-600 transition-colors">
                                    <Mic size={20}/>
                                </button>
                                <input 
                                    className="flex-1 bg-slate-100 border border-slate-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-1 focus:ring-teal-500"
                                    placeholder={lang === 'hi' ? "Type or speak..." : "Type or speak..."}
                                    value={query}
                                    onChange={(e) => setQuery(e.target.value)}
                                    onKeyPress={(e) => e.key === 'Enter' && handleAsk()}
                                />
                                <button onClick={handleAsk} disabled={loading} className="bg-teal-700 text-white p-2 rounded-md hover:bg-teal-800 disabled:opacity-50"><Send size={18}/></button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };
        
        const DoctorAudioModal = ({ isOpen, onClose, riskLevel }) => {
            if (!isOpen) return null;
            const msg = DOCTOR_MESSAGES[riskLevel] || DOCTOR_MESSAGES.GREEN;
            
            return (
                <div className="fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-6 backdrop-blur-sm animate-in zoom-in duration-300">
                    <div className="bg-white w-full max-w-sm rounded-xl shadow-2xl overflow-hidden border border-slate-200">
                        <div className="bg-slate-900 p-4 flex justify-between items-center text-white">
                            <h3 className="font-bold flex items-center gap-2">
                                <Stethoscope size={20} className="text-emerald-400"/>
                                Doctor's Message
                            </h3>
                            <button onClick={onClose}><X size={24} className="text-slate-400 hover:text-white"/></button>
                        </div>
                        <div className="p-6 flex flex-col items-center text-center">
                            <div className="w-24 h-24 rounded-full bg-slate-200 mb-4 border-4 border-white shadow-lg overflow-hidden relative">
                                <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=DrSharma&backgroundColor=c0aede" alt="Doctor" className="w-full h-full object-cover"/>
                            </div>
                            <h2 className="text-xl font-bold text-slate-800">Dr. Sharma</h2>
                            <p className="text-xs font-bold text-slate-500 uppercase tracking-widest mb-4">Chief Medical Officer</p>
                            
                            <div className={`w-full p-4 rounded-lg mb-4 text-left border ${riskLevel === 'RED' ? 'bg-rose-50 border-rose-200' : 'bg-slate-50 border-slate-200'}`}>
                                <div className="flex justify-between items-center mb-2">
                                    <span className={`text-[10px] font-bold px-2 py-0.5 rounded-full uppercase ${riskLevel === 'RED' ? 'bg-rose-600 text-white' : 'bg-slate-600 text-white'}`}>
                                        {msg.type}
                                    </span>
                                    <Volume2 size={16} className="text-slate-400 animate-pulse"/>
                                </div>
                                <p className="text-sm font-medium text-slate-800 italic">"{msg.text}"</p>
                            </div>
                            
                            <div className="flex gap-1 h-6 items-end justify-center w-full px-10 opacity-70">
                                {[...Array(10)].map((_, i) => (
                                    <div key={i} className="bar" style={{animationDelay: `${i * 0.1}s`, height: `${Math.random() * 20 + 5}px`}}></div>
                                ))}
                            </div>
                        </div>
                        <div className="p-4 bg-slate-50 border-t border-slate-200">
                            <button onClick={onClose} className="w-full bg-slate-900 text-white py-3 rounded-lg font-bold hover:bg-slate-800">Close</button>
                        </div>
                    </div>
                </div>
            );
        };
        
        const QrScannerModal = ({ isOpen, onClose, onScan }) => {
            if(!isOpen) return null;
            
            useEffect(() => {
                const timer = setTimeout(() => {
                    onScan({ name: "Rani Devi", age: "26", weeks: "28", phone: "9876500000", village: "Kailashpur" });
                }, 3000);
                return () => clearTimeout(timer);
            }, []);

            return (
                <div className="fixed inset-0 bg-black z-[60] flex flex-col items-center justify-center">
                    <div className="absolute top-0 w-full p-4 flex justify-between items-center text-white z-10">
                         <button onClick={onClose}><X size={24}/></button>
                         <span className="font-bold">Scan Health Card</span>
                         <div className="w-6"></div>
                    </div>
                    
                    <div className="relative w-full h-full flex flex-col items-center justify-center">
                        <div className="w-64 h-64 border-2 border-teal-500 rounded-lg relative overflow-hidden">
                             <div className="scan-line"></div>
                             <p className="text-white/70 text-center mt-28">Align QR Code</p>
                        </div>
                        <p className="text-white mt-8 animate-pulse">Scanning...</p>
                    </div>
                </div>
            );
        };
        
        const NotificationCenter = ({ isOpen, onClose, notifications, clearAll, t }) => {
            if (!isOpen) return null;
            
            return (
                <div className="fixed inset-0 bg-black/30 z-[60] flex justify-end backdrop-blur-sm animate-in fade-in">
                    <div className="w-80 h-full bg-white shadow-2xl animate-in slide-in-from-right flex flex-col">
                        <div className="p-4 bg-slate-900 text-white flex justify-between items-center">
                            <h2 className="font-bold flex items-center gap-2"><Bell size={18}/> {t('Notifications')}</h2>
                            <button onClick={onClose}><X size={20} className="text-slate-400 hover:text-white"/></button>
                        </div>
                        <div className="flex-1 overflow-y-auto p-4 space-y-3">
                            {notifications.length === 0 && <p className="text-slate-400 text-center mt-10 text-sm">No new notifications</p>}
                            {notifications.map(n => (
                                <div key={n.id} className="bg-slate-50 border border-slate-100 p-3 rounded-lg relative">
                                    <div className="flex gap-3">
                                        <div className={`mt-1 p-1.5 rounded-full h-fit ${
                                            n.type === 'alert' ? 'bg-rose-100 text-rose-600' : 
                                            n.type === 'credit' ? 'bg-emerald-100 text-emerald-600' : 
                                            'bg-blue-100 text-blue-600'
                                        }`}>
                                            {n.type === 'alert' ? <AlertTriangle size={14}/> : 
                                             n.type === 'credit' ? <IndianRupee size={14}/> : 
                                             <Info size={14}/>}
                                        </div>
                                        <div>
                                            <h4 className="text-sm font-bold text-slate-800">{n.title}</h4>
                                            <p className="text-xs text-slate-600 mt-0.5 leading-snug">{n.msg}</p>
                                            <p className="text-[10px] text-slate-400 mt-1">{n.time}</p>
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>
                        <div className="p-4 border-t border-slate-100">
                            <button onClick={clearAll} className="w-full text-xs font-bold text-slate-500 hover:text-slate-800 uppercase tracking-widest">{t('Clear All')}</button>
                        </div>
                    </div>
                </div>
            );
        };

        // --- MAIN APP ---
        function SanrakshaApp() {
            const [screen, setScreen] = useState('splash');
            const [lang, setLang] = useState('en');
            const [isOnline, setIsOnline] = useState(true);
            
            // Persistent Data State (Load from localStorage)
            const [mothers, setMothers] = useState(() => {
                const saved = localStorage.getItem('mothers');
                return saved ? JSON.parse(saved) : INITIAL_MOTHERS;
            });
            const [inventory, setInventory] = useState(() => {
                const saved = localStorage.getItem('inventory');
                return saved ? JSON.parse(saved) : INITIAL_INVENTORY;
            });
            const [notifications, setNotifications] = useState(() => {
                 const saved = localStorage.getItem('notifications');
                 return saved ? JSON.parse(saved) : INITIAL_NOTIFICATIONS;
            });
            
            const [selectedMother, setSelectedMother] = useState(null);
            
            // Checkup State
            const [asdtColor, setAsdtColor] = useState(null);
            const [symptoms, setSymptoms] = useState({});
            const [qIndex, setQIndex] = useState(0);
            const [riskLevel, setRiskLevel] = useState('GREEN');
            const [riskScore, setRiskScore] = useState(0);
            const [showDoctorModal, setShowDoctorModal] = useState(false);
            const [showQr, setShowQr] = useState(false);
            const [showNotifications, setShowNotifications] = useState(false);
            
            // Login & 2FA State
            const [loginOtpSent, setLoginOtpSent] = useState(false);
            const [loginOtp, setLoginOtp] = useState("");
            
            // Referral State
            const [referralId, setReferralId] = useState(null);
            const [ambulanceStatus, setAmbulanceStatus] = useState("idle"); 
            
            // Gamification State
            const [stars, setStars] = useState(150);
            const [simLabAnswered, setSimLabAnswered] = useState(false);

            // New Registration State
            const [newReg, setNewReg] = useState({ name: '', age: '', weeks: '', phone: '', village: '', bp: '', weight: '' });
            const [isSyncing, setIsSyncing] = useState(false);

            // UI State
            const [showChat, setShowChat] = useState(false);
            const [searchQuery, setSearchQuery] = useState('');
            const [dashboardTab, setDashboardTab] = useState('all');
            const [financeTab, setFinanceTab] = useState('ledger'); 
            const [trainingTab, setTrainingTab] = useState('modules'); 

            // Save to localStorage whenever data changes
            useEffect(() => {
                localStorage.setItem('mothers', JSON.stringify(mothers));
            }, [mothers]);

            useEffect(() => {
                localStorage.setItem('inventory', JSON.stringify(inventory));
            }, [inventory]);
            
            useEffect(() => {
                localStorage.setItem('notifications', JSON.stringify(notifications));
            }, [notifications]);

            useEffect(() => {
                if (screen === 'splash') {
                    const timer = setTimeout(() => setScreen('login'), 2500); 
                    return () => clearTimeout(timer);
                }
            }, [screen]);

            // Simulate toggling connectivity
            useEffect(() => {
                const interval = setInterval(() => {
                    // Just to show the visual, we won't actually toggle it often
                    // setIsOnline(prev => !prev); 
                }, 10000);
                return () => clearInterval(interval);
            }, []);

            // Translation Helper
            const t = (text) => {
                if (lang === 'en') return text;
                const entry = TRANSLATIONS[text];
                return entry ? entry.hi : text;
            };

            // --- HELPER FUNCTIONS ---
            const calculateRisk = () => {
                let score = 0;
                // Add Anaemia Score
                const colorObj = ANAEMIA_SCALE.find(c => c.id === asdtColor);
                if (colorObj) score += colorObj.risk;
                
                // Add Symptom Score
                Object.keys(symptoms).forEach(k => {
                    if (symptoms[k]) {
                        const sym = SYMPTOM_CHECKLIST.find(s => s.id === k);
                        if (sym) score += sym.weight;
                    }
                });

                setRiskScore(score);
                if (score >= 61) setRiskLevel('RED');
                else if (score >= 31) setRiskLevel('ORANGE');
                else if (score >= 11) setRiskLevel('YELLOW');
                else setRiskLevel('GREEN');
                
                setScreen('result');
            };

            const handleSymptomAnswer = (answer) => {
                const currentQ = SYMPTOM_CHECKLIST[qIndex];
                setSymptoms(prev => ({ ...prev, [currentQ.id]: answer }));
                
                if (qIndex < SYMPTOM_CHECKLIST.length - 1) {
                    setQIndex(qIndex + 1);
                } else {
                    calculateRisk();
                }
            };

            const handleRegister = () => {
                const newMom = {
                    id: Date.now(),
                    ...newReg,
                    lastVisit: "Just now",
                    image: (newReg.name || "??").substring(0,2).toUpperCase(),
                    history: "G1P0", // Default
                    risk: "low",
                    anemia: "none",
                    bp: newReg.bp || "120/80",
                    weight: newReg.weight || "50",
                    hemoglobin: "11.0",
                    address: newReg.village || "Unknown",
                    lmp: new Date().toISOString().split('T')[0],
                    edd: new Date(Date.now() + 24192000000).toISOString().split('T')[0], // approx 9 months
                    hbHistory: []
                };
                setMothers([newMom, ...mothers]);
                setScreen('home');
                setNewReg({ name: '', age: '', weeks: '', phone: '', village: '', bp: '', weight: '' });
                alert("Saved locally! Data will auto-populate ANC and Immunization registers when online.");
            };
            
            const handleBluetoothSync = () => {
                setIsSyncing(true);
                setTimeout(() => {
                    setNewReg(prev => ({
                        ...prev,
                        bp: "118/76",
                        weight: "54.2"
                    }));
                    setIsSyncing(false);
                    alert("Vitals Synced from Device!");
                }, 2000);
            };
            
            const handleQrScan = (data) => {
                setShowQr(false);
                setNewReg(prev => ({ ...prev, ...data }));
                setScreen('registration'); // Ensure we are on registration screen if scan called from elsewhere
                alert("Health Card Scanned Successfully!");
            };
            
            const sendSmsReminder = () => {
                alert(`SMS Reminder sent to ${selectedMother.name}: "Please take your IFA tablet and visit the center on Monday."`);
            };
            
            const handleReorder = (itemId) => {
                setInventory(prev => ({
                    ...prev,
                    [itemId]: { ...prev[itemId], status: 'ordered' }
                }));
                // Add notification
                setNotifications(prev => [{ id: Date.now(), type: 'info', title: 'Order Placed', msg: `Order for ${inventory[itemId].name} sent to PHC.`, time: 'Just now' }, ...prev]);
                alert("Order request sent to PHC via SMS!");
            };
            
            const handleSimLabAnswer = (correct) => {
                setSimLabAnswered(true);
                if (correct) {
                    setStars(prev => prev + 10);
                }
            };
            
            const initiateReferral = () => {
                const id = `REF-${Math.floor(1000 + Math.random() * 9000)}`;
                setReferralId(id);
                setScreen('referral');
                setAmbulanceStatus("searching");
                
                setTimeout(() => setAmbulanceStatus("connected"), 3000);
            };
            
            const handleEmergencyCall = (number) => {
                alert(`Dialing ${number}...`);
            };
            
            const handlePeerRequest = (peerName) => {
                alert(`Request sent to ${peerName} for group visit!`);
            };

            const submitAnonymousReport = () => {
                alert("Report submitted anonymously. Ticket ID: #SAFE-99");
            };
            
            const handleLoginSendOtp = () => {
                setLoginOtpSent(true);
                alert("OTP Sent: 1234");
            };
            
            const handleLoginSubmit = () => {
                if(!loginOtp) {
                    alert("Please enter the OTP.");
                    return;
                }
                setScreen('home');
            };

            // --- RENDERERS ---

            const Header = ({ title, backAction, onMenuClick }) => (
                <div className="bg-slate-900 text-white px-4 py-3 shadow-md sticky top-0 z-20 flex justify-between items-center border-b border-slate-800">
                    <div className="flex items-center gap-3">
                        {backAction ? (
                            <button onClick={backAction} className="p-1 hover:bg-slate-700 rounded-full transition"><ArrowLeft size={20}/></button>
                        ) : (
                            <button onClick={onMenuClick} className="p-1 hover:bg-slate-700 rounded-full transition"><Menu size={20}/></button>
                        )}
                        <h1 className="text-md font-semibold tracking-wide">{t(title)}</h1>
                    </div>
                    <div className="flex items-center gap-3">
                        {/* Notification Bell */}
                        <button onClick={() => setShowNotifications(true)} className="relative p-1 hover:bg-slate-700 rounded-full">
                            <Bell size={20}/>
                            {notifications.length > 0 && <span className="absolute top-0 right-0 w-2.5 h-2.5 bg-rose-500 rounded-full border border-slate-900"></span>}
                        </button>
                        
                        {isOnline ? (
                            <div className="flex items-center gap-1 bg-emerald-900/50 px-2 py-0.5 rounded-full border border-emerald-700">
                                <Cloud size={10} className="text-emerald-400"/>
                                <span className="text-[10px] font-bold text-emerald-400 uppercase">{t('Synced')}</span>
                            </div>
                        ) : (
                            <div className="flex items-center gap-1 bg-amber-900/50 px-2 py-0.5 rounded-full border border-amber-700">
                                <Database size={10} className="text-amber-400"/>
                                <span className="text-[10px] font-bold text-amber-400 uppercase">{t('Offline')}</span>
                            </div>
                        )}
                        <button onClick={() => setLang(l => l === 'hi' ? 'en' : 'hi')} className="text-xs font-bold bg-slate-700 px-2 py-1 rounded text-slate-200">
                            {lang === 'hi' ? 'HI' : 'EN'}
                        </button>
                    </div>
                </div>
            );

            const renderForgotPin = () => (
                <div className="min-h-screen bg-slate-50 flex flex-col items-center justify-center p-6 relative overflow-hidden">
                    <div className="absolute top-0 left-0 w-full h-1/2 bg-slate-800 rounded-b-[3rem] shadow-2xl z-0"></div>
                    <div className="relative z-10 w-full max-w-sm">
                        <div className="bg-white rounded-xl shadow-xl p-8 border border-slate-100">
                            <h2 className="text-xl font-semibold text-slate-800 mb-6">{t('Reset PIN')}</h2>
                            <div className="space-y-4">
                                <div className="flex items-center border border-slate-300 rounded-lg px-3 py-2.5 focus-within:ring-2 focus-within:ring-teal-600">
                                    <UserCircle size={18} className="text-slate-400 mr-3"/>
                                    <input type="text" className="w-full outline-none text-slate-900" placeholder={t('ASHA ID')} />
                                </div>
                                <div className="flex items-center border border-slate-300 rounded-lg px-3 py-2.5 focus-within:ring-2 focus-within:ring-teal-600">
                                    <Phone size={18} className="text-slate-400 mr-3"/>
                                    <input type="tel" maxLength="10" className="w-full outline-none text-slate-900" placeholder={t('Mobile Number')} />
                                </div>
                                <button onClick={() => alert("OTP Sent: 5678")} className="text-sm font-bold text-teal-700 border border-teal-200 bg-teal-50 px-3 py-2 rounded-lg w-full hover:bg-teal-100">
                                    {t('Send OTP')}
                                </button>
                                <div className="flex items-center border border-slate-300 rounded-lg px-3 py-2.5 focus-within:ring-2 focus-within:ring-teal-600">
                                    <KeyRound size={18} className="text-slate-400 mr-3"/>
                                    <input type="text" maxLength="4" className="w-full outline-none text-slate-900" placeholder={t('Enter OTP')} />
                                </div>
                                <div className="flex items-center border border-slate-300 rounded-lg px-3 py-2.5 focus-within:ring-2 focus-within:ring-teal-600">
                                    <Lock size={18} className="text-slate-400 mr-3"/>
                                    <input type="password" maxLength="6" className="w-full outline-none text-slate-900" placeholder={t('New PIN')} />
                                </div>
                                <div className="flex items-center border border-slate-300 rounded-lg px-3 py-2.5 focus-within:ring-2 focus-within:ring-teal-600">
                                    <Lock size={18} className="text-slate-400 mr-3"/>
                                    <input type="password" maxLength="6" className="w-full outline-none text-slate-900" placeholder={t('Confirm New PIN')} />
                                </div>
                                <button onClick={() => setScreen('login')} className="w-full bg-slate-800 hover:bg-slate-900 text-white font-semibold py-3 rounded-lg shadow-md mt-2 flex justify-center gap-2 active:scale-95 transition-transform duration-150">
                                    {t('Reset Password')}
                                </button>
                                <button onClick={() => setScreen('login')} className="w-full text-sm text-slate-500 font-medium py-2">
                                    {t('Back to Login')}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );

            const renderLogin = () => (
                <div className="min-h-screen bg-slate-50 flex flex-col items-center justify-center p-6 relative overflow-hidden">
                    <div className="absolute top-0 left-0 w-full h-1/2 bg-slate-900 rounded-b-[3rem] shadow-2xl z-0"></div>
                    <div className="relative z-10 w-full max-w-sm">
                        <div className="text-center mb-10">
                            <div className="w-20 h-20 bg-white rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg border border-slate-100">
                                <ShieldCheck size={40} className="text-teal-700" />
                            </div>
                            <h1 className="text-3xl font-bold text-white tracking-tight mb-1">Sanraksha</h1>
                            <p className="text-slate-400 text-sm font-medium uppercase tracking-wider">ASHA Support System</p>
                        </div>
                        <div className="bg-white rounded-xl shadow-xl p-8 border border-slate-100">
                            <h2 className="text-xl font-semibold text-slate-800 mb-6">{t('Secure Login')}</h2>
                            <div className="space-y-4">
                                <div className="flex items-center border border-slate-300 rounded-lg px-3 py-2.5 focus-within:ring-2 focus-within:ring-teal-600">
                                    <Phone size={18} className="text-slate-400 mr-3"/>
                                    <input type="tel" maxLength="10" className="w-full outline-none text-slate-900" placeholder={t('Mobile Number')} />
                                </div>
                                <div className="flex items-center border border-slate-300 rounded-lg px-3 py-2.5 focus-within:ring-2 focus-within:ring-teal-600">
                                    <Lock size={18} className="text-slate-400 mr-3"/>
                                    <input type="password" maxLength="6" className="w-full outline-none text-slate-900" placeholder={t('PIN')} />
                                </div>
                                
                                {!loginOtpSent ? (
                                    <button onClick={handleLoginSendOtp} className="w-full text-sm font-bold text-teal-700 bg-teal-50 border border-teal-200 py-2.5 rounded-lg hover:bg-teal-100 transition shadow-sm mt-2 active:scale-95 transition-transform duration-150">
                                        {t('Send OTP')}
                                    </button>
                                ) : (
                                    <div className="animate-in fade-in space-y-4">
                                        <div className="flex items-center border border-slate-300 rounded-lg px-3 py-2.5 focus-within:ring-2 focus-within:ring-teal-600">
                                            <KeyRound size={18} className="text-slate-400 mr-3"/>
                                            <input 
                                                type="text" 
                                                maxLength="4"
                                                className="w-full outline-none text-slate-900" 
                                                placeholder={t('Enter OTP')}
                                                value={loginOtp}
                                                onChange={(e) => setLoginOtp(e.target.value)}
                                            />
                                        </div>
                                        <div className="flex justify-between items-center">
                                            <button onClick={() => { setLoginOtpSent(false); setLoginOtp(""); }} className="text-xs text-teal-600 font-bold hover:underline">{t('Resend')}</button>
                                        </div>
                                        <button onClick={handleLoginSubmit} className="w-full bg-teal-700 hover:bg-teal-800 text-white font-semibold py-3 rounded-lg shadow-md flex justify-center gap-2 active:scale-95 transition-transform duration-150">
                                            {t('Verify & Login')} <ArrowRight size={18}/>
                                        </button>
                                    </div>
                                )}

                                {!loginOtpSent && (
                                    <div className="flex justify-end mt-1">
                                        <button onClick={() => setScreen('forgot_pin')} className="text-xs font-bold text-slate-500 hover:text-slate-800">
                                            {t('Forgot PIN?')}
                                        </button>
                                    </div>
                                )}
                            </div>
                        </div>
                        {/* Govt Branding */}
                        <div className="mt-12 flex flex-col items-center opacity-60">
                            <div className="flex items-center gap-3">
                                <Landmark size={24} className="text-white"/>
                                <div className="text-left text-white">
                                    <p className="text-[10px] font-bold uppercase tracking-widest leading-tight">{t('National Health Mission')}</p>
                                    <p className="text-[8px] font-medium leading-tight">{t('Digital India')} Initiative</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );

            const renderHome = () => {
                const total = mothers.length;
                const anemic = mothers.filter(m => Number(m.hemoglobin) < 11).length;
                const filtered = mothers.filter(m => {
                    const matchSearch = m.name.toLowerCase().includes(searchQuery.toLowerCase()) || 
                                      m.village.toLowerCase().includes(searchQuery.toLowerCase());
                    if (dashboardTab === 'high_risk') return matchSearch && m.risk === 'high';
                    return matchSearch;
                });

                return (
                    <div className="pb-24 animate-in fade-in">
                        {/* Stats Dashboard */}
                        <div className="p-4 grid grid-cols-3 gap-3">
                            <div className="bg-white p-3 rounded-lg shadow-sm border border-slate-200 border-t-4 border-t-teal-600 flex flex-col justify-between hover:scale-105 transition-transform duration-200 cursor-default">
                                <p className="text-[10px] font-bold text-slate-500 uppercase">{t('Total Cases')}</p>
                                <p className="text-2xl font-bold text-slate-800 mt-1">{total}</p>
                            </div>
                            <div className="bg-white p-3 rounded-lg shadow-sm border border-slate-200 border-t-4 border-t-rose-500 flex flex-col justify-between hover:scale-105 transition-transform duration-200 cursor-default">
                                <p className="text-[10px] font-bold text-slate-500 uppercase">{t('High Risk')}</p>
                                <p className="text-2xl font-bold text-slate-800 mt-1">{mothers.filter(m=>m.risk==='high').length}</p>
                            </div>
                            <div className="bg-white p-3 rounded-lg shadow-sm border border-slate-200 border-t-4 border-t-amber-500 flex flex-col justify-between hover:scale-105 transition-transform duration-200 cursor-default">
                                <p className="text-[10px] font-bold text-slate-500 uppercase">{t('Anemic')}</p>
                                <p className="text-2xl font-bold text-slate-800 mt-1">{anemic}</p>
                            </div>
                        </div>
                        
                        {/* Outcomes Notification Loop */}
                        <div className="px-4 mb-4">
                            <div className="bg-indigo-50 border border-indigo-100 rounded-lg p-3">
                                <div className="flex items-center gap-2 mb-2">
                                    <Bell size={14} className="text-indigo-600 fill-indigo-600"/>
                                    <h4 className="text-xs font-bold text-indigo-800 uppercase">{t('Recent Outcomes')}</h4>
                                </div>
                                <div className="space-y-2">
                                    {OUTCOMES.map(o => (
                                        <div key={o.id} className="bg-white p-2 rounded shadow-sm text-xs flex justify-between items-center">
                                            <span className="text-slate-700 font-medium">{o.text}</span>
                                            <span className="text-slate-400 text-[10px]">{o.time}</span>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>

                        {/* Quick Actions Grid */}
                        <div className="px-4 mb-4">
                            <h3 className="text-xs font-bold text-slate-400 uppercase mb-3">{t('Quick Actions')}</h3>
                            <div className="grid grid-cols-2 gap-3">
                                <button onClick={() => setScreen('registration')} className="bg-white p-3 rounded-lg border border-slate-200 shadow-sm flex items-center gap-3 hover:bg-slate-50 active:scale-95 transition-transform duration-150">
                                    <div className="bg-teal-50 p-2 rounded text-teal-700"><Plus size={18}/></div>
                                    <span className="text-sm font-medium text-slate-700">{t('New Reg.')}</span>
                                </button>
                                <button onClick={() => setShowQr(true)} className="bg-white p-3 rounded-lg border border-slate-200 shadow-sm flex items-center gap-3 hover:bg-slate-50 active:scale-95 transition-transform duration-150">
                                    <div className="bg-indigo-50 p-2 rounded text-indigo-700"><Scan size={18}/></div>
                                    <span className="text-sm font-medium text-slate-700">{t('Scan QR')}</span>
                                </button>
                                <button onClick={() => setScreen('inventory')} className="bg-white p-3 rounded-lg border border-slate-200 shadow-sm flex items-center gap-3 hover:bg-slate-50 active:scale-95 transition-transform duration-150">
                                    <div className="bg-amber-50 p-2 rounded text-amber-700"><Package size={18}/></div>
                                    <span className="text-sm font-medium text-slate-700">{t('Inventory')}</span>
                                </button>
                                <button onClick={() => setScreen('training')} className="bg-white p-3 rounded-lg border border-slate-200 shadow-sm flex items-center gap-3 hover:bg-slate-50 active:scale-95 transition-transform duration-150">
                                    <div className="bg-cyan-50 p-2 rounded text-cyan-700"><BookOpen size={18}/></div>
                                    <span className="text-sm font-medium text-slate-700">{t('Academy')}</span>
                                </button>
                            </div>
                        </div>

                        {/* Search & List */}
                        <div className="px-4 mb-3">
                            <div className="bg-white border border-slate-300 rounded-lg flex items-center px-3 shadow-sm mb-3">
                                <Search size={18} className="text-slate-400"/>
                                <input 
                                    type="text" 
                                    placeholder={t('Search patients...')}
                                    className="w-full py-2.5 px-2 outline-none text-sm text-slate-700"
                                    value={searchQuery}
                                    onChange={(e) => setSearchQuery(e.target.value)}
                                />
                            </div>
                            {filtered.map((m, i) => (
                                <div key={m.id} style={{animationDelay: `${i * 75}ms`}} onClick={() => { setSelectedMother(m); setScreen('patient_detail'); }} className="bg-white p-4 rounded-lg border border-slate-200 shadow-sm mb-3 cursor-pointer flex justify-between items-center animate-in slide-in-from-bottom-2 fade-in duration-300 fill-mode-backwards hover:bg-slate-50 active:scale-[0.98] transition-transform">
                                    <div className="flex items-center gap-3">
                                        <div className={`w-10 h-10 rounded-full flex items-center justify-center font-bold text-sm ${m.risk === 'high' ? 'bg-rose-100 text-rose-700' : 'bg-slate-100 text-slate-600'}`}>{m.image}</div>
                                        <div>
                                            <h3 className="font-semibold text-slate-800 text-sm">{m.name}</h3>
                                            <p className="text-xs text-slate-500">{m.weeks} {t('Weeks')} ‚Ä¢ {m.village}</p>
                                        </div>
                                    </div>
                                    <div className="flex items-center gap-2">
                                        {m.risk === 'high' && <span className="text-[10px] font-bold bg-rose-50 text-rose-600 px-2 py-1 rounded border border-rose-100 uppercase animate-heartbeat">{t('High Risk')}</span>}
                                        <ChevronRight size={18} className="text-slate-300"/>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                );
            };

            const renderInventory = () => (
                <div className="p-4 space-y-4 animate-in slide-in-from-right">
                    <h2 className="text-xl font-bold text-slate-800">{t('Medical Inventory')}</h2>
                    {Object.values(inventory).map((item, i) => {
                        const isLow = item.status === 'low' || item.count <= item.min;
                        const isOrdered = item.status === 'ordered';
                        
                        return (
                            <div key={item.id} style={{animationDelay: `${i * 75}ms`}} className={`bg-white p-4 rounded-lg border ${isLow ? 'border-rose-300 bg-rose-50' : 'border-slate-200'} shadow-sm flex justify-between items-center animate-in slide-in-from-bottom-2 fade-in duration-300 fill-mode-backwards`}>
                                <div className="flex items-center gap-4">
                                    <div className={`p-3 rounded-full ${isLow ? 'bg-rose-100 text-rose-600' : 'bg-emerald-100 text-emerald-600'}`}>
                                        <Package size={20} />
                                    </div>
                                    <div>
                                        <h3 className="font-bold text-slate-800">{item.name}</h3>
                                        <p className={`text-sm font-medium ${isLow ? 'text-rose-600' : 'text-slate-500'}`}>
                                            {item.count} {item.unit} {isLow ? `(${t('Low Stock')})` : t('remaining')}
                                        </p>
                                    </div>
                                </div>
                                {isLow && !isOrdered && (
                                    <button onClick={() => handleReorder(item.id)} className="bg-rose-600 text-white px-3 py-1.5 rounded-full text-xs font-bold shadow-md hover:bg-rose-700 animate-pulse active:scale-95 transition-transform duration-150">
                                        {t('Order Now')}
                                    </button>
                                )}
                                {isOrdered && (
                                    <span className="text-xs font-bold text-amber-600 bg-amber-100 px-2 py-1 rounded">{t('Ordered')}</span>
                                )}
                                {!isLow && !isOrdered && (
                                    <button className="bg-slate-100 text-slate-600 p-2 rounded hover:bg-slate-200 active:scale-95 transition-transform"><RefreshCw size={18}/></button>
                                )}
                            </div>
                        );
                    })}
                </div>
            );

            const renderTraining = () => (
                <div className="h-full flex flex-col bg-slate-50">
                    {/* Header with Gamification */}
                    <div className="bg-slate-900 p-6 pb-12 text-white">
                        <div className="flex justify-between items-center mb-4">
                             <h2 className="text-xl font-bold flex items-center gap-2"><GraduationCap className="text-teal-400"/> {t('ASHA Academy')}</h2>
                             <div className="flex items-center gap-1 bg-white/10 px-3 py-1 rounded-full border border-white/20">
                                <Star size={16} className="text-yellow-400 fill-yellow-400"/>
                                <span className="font-bold">{stars} Stars</span>
                             </div>
                        </div>
                        <p className="text-slate-400 text-sm">{t('Learn, Practice, and Master your skills.')}</p>
                    </div>

                    {/* Tab Navigation */}
                    <div className="-mt-6 px-4 flex gap-2">
                        {['modules', 'echo', 'sim'].map(tab => (
                            <button 
                                key={tab}
                                onClick={() => setTrainingTab(tab)}
                                className={`flex-1 py-3 text-sm font-bold rounded-lg shadow-sm transition-all ${trainingTab === tab ? 'bg-teal-600 text-white' : 'bg-white text-slate-600 border border-slate-200'}`}
                            >
                                {tab === 'modules' ? t('Learn') : tab === 'echo' ? t('ECHO Live') : t('Sim Lab')}
                            </button>
                        ))}
                    </div>

                    <div className="flex-1 overflow-y-auto p-4 space-y-4">
                        {trainingTab === 'modules' && (
                             <div className="space-y-3 animate-in fade-in">
                                {[{title: "PPH Management", type: "Video", min: "10"}, {title: "Neonatal Care", type: "Audio", min: "5"}, {title: "Hypertension", type: "Quiz", min: "15"}].map((m, i) => (
                                    <div key={i} className="bg-white p-4 rounded-lg border border-slate-200 shadow-sm flex justify-between items-center">
                                        <div>
                                            <h4 className="font-bold text-slate-800">{m.title}</h4>
                                            <p className="text-xs text-slate-500">{m.type} ‚Ä¢ {m.min} mins</p>
                                        </div>
                                        <button className="text-teal-700 hover:text-teal-900 active:scale-95 transition-transform"><PlayCircle size={24}/></button>
                                    </div>
                                ))}
                             </div>
                        )}

                        {trainingTab === 'echo' && (
                            <div className="space-y-3 animate-in fade-in">
                                <div className="bg-indigo-50 p-4 rounded-lg border border-indigo-100 flex gap-3">
                                    <div className="bg-indigo-100 p-2 rounded-full h-fit"><Users className="text-indigo-600" size={20}/></div>
                                    <div>
                                        <h4 className="font-bold text-indigo-900 text-sm">{t('ECHO Hub')}</h4>
                                        <p className="text-xs text-indigo-700 mt-1">Connect with specialists live. Ask questions and discuss complex cases.</p>
                                    </div>
                                </div>
                                {ECHO_SESSIONS.map((s) => (
                                    <div key={s.id} className="bg-white p-4 rounded-lg border border-slate-200 shadow-sm">
                                        <div className="flex justify-between items-start mb-2">
                                            <span className={`text-[10px] font-bold px-2 py-0.5 rounded uppercase ${s.status === 'live' ? 'bg-red-100 text-red-600 animate-pulse' : 'bg-slate-100 text-slate-500'}`}>{s.status === 'live' ? '‚óè Live Now' : 'Upcoming'}</span>
                                            <span className="text-xs font-bold text-slate-500">{s.time}</span>
                                        </div>
                                        <h4 className="font-bold text-slate-800">{s.title}</h4>
                                        <p className="text-sm text-slate-500 mb-3">with {s.doctor}</p>
                                        <button disabled={s.status !== 'live'} className={`w-full py-2 rounded font-bold text-sm active:scale-95 transition-transform duration-150 ${s.status === 'live' ? 'bg-indigo-600 text-white' : 'bg-slate-100 text-slate-400'}`}>
                                            {s.status === 'live' ? 'Join Session' : 'Remind Me'}
                                        </button>
                                    </div>
                                ))}
                            </div>
                        )}

                        {trainingTab === 'sim' && (
                            <div className="animate-in fade-in">
                                {!simLabAnswered ? (
                                    <div className="bg-white p-6 rounded-xl border-2 border-slate-200 shadow-lg">
                                        <div className="flex justify-between items-center mb-4">
                                            <h3 className="font-bold text-lg text-slate-800">{t('Daily Challenge')}</h3>
                                            <span className="text-xs font-bold bg-yellow-100 text-yellow-700 px-2 py-1 rounded">+10 Stars</span>
                                        </div>
                                        <p className="text-sm text-slate-600 mb-4 font-medium">Case: A 24-year-old pregnant woman (28 weeks) complains of severe headache and blurred vision. Her BP is 150/100. What is your immediate action?</p>
                                        <div className="space-y-3">
                                            <button onClick={() => handleSimLabAnswer(false)} className="w-full text-left p-3 border border-slate-200 rounded-lg hover:bg-rose-50 hover:border-rose-200 text-sm active:scale-[0.98] transition-transform">A. Tell her to rest and drink water.</button>
                                            <button onClick={() => handleSimLabAnswer(true)} className="w-full text-left p-3 border border-slate-200 rounded-lg hover:bg-teal-50 hover:border-teal-200 text-sm active:scale-[0.98] transition-transform">B. Refer immediately for Preeclampsia.</button>
                                            <button onClick={() => handleSimLabAnswer(false)} className="w-full text-left p-3 border border-slate-200 rounded-lg hover:bg-rose-50 hover:border-rose-200 text-sm active:scale-[0.98] transition-transform">C. Give Iron tablet and check next week.</button>
                                        </div>
                                    </div>
                                ) : (
                                    <div className="bg-teal-50 p-6 rounded-xl border-2 border-teal-200 shadow-lg text-center pop-in">
                                        <div className="w-16 h-16 bg-teal-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                            <Trophy size={32} className="text-teal-600"/>
                                        </div>
                                        <h3 className="font-bold text-xl text-teal-800 mb-2">Excellent Work!</h3>
                                        <p className="text-sm text-teal-700 mb-4">That is correct. High BP with headache suggests Preeclampsia.</p>
                                        <button onClick={() => setSimLabAnswered(false)} className="text-xs font-bold text-teal-600 underline">Try another case</button>
                                    </div>
                                )}
                            </div>
                        )}
                    </div>
                </div>
            );

            const renderFinance = () => (
                <div className="h-full flex flex-col bg-slate-50 animate-in slide-in-from-right">
                    <div className="bg-slate-900 text-white p-6 pb-6">
                        <h2 className="text-xl font-bold mb-1">{t('Finance Hub')}</h2>
                        <p className="text-slate-400 text-xs">{t('Track your earnings and benefits')}</p>
                    </div>

                    <div className="flex border-b border-slate-200 bg-white">
                        {['ledger', 'salary', 'benefits'].map(tab => (
                            <button 
                                key={tab}
                                onClick={() => setFinanceTab(tab)}
                                className={`flex-1 py-3 text-sm font-bold capitalize ${financeTab === tab ? 'text-teal-700 border-b-2 border-teal-600' : 'text-slate-500'}`}
                            >
                                {t(tab.charAt(0).toUpperCase() + tab.slice(1))}
                            </button>
                        ))}
                    </div>

                    <div className="flex-1 overflow-y-auto p-4">
                        {financeTab === 'ledger' && (
                            <div className="space-y-3">
                                {FINANCE_DATA.ledger.map(item => (
                                    <div key={item.id} className="bg-white p-4 rounded-lg border border-slate-200 shadow-sm flex justify-between items-center">
                                        <div>
                                            <h4 className="font-bold text-slate-800 text-sm">{item.desc}</h4>
                                            <p className="text-xs text-slate-500">{item.date}</p>
                                        </div>
                                        <div className="text-right">
                                            <p className={`font-bold ${item.status === 'credited' ? 'text-emerald-600' : 'text-amber-600'}`}>‚Çπ{item.amount}</p>
                                            <span className={`text-[10px] font-bold uppercase ${item.status === 'credited' ? 'bg-emerald-50 text-emerald-600' : 'bg-amber-50 text-amber-600'} px-1.5 py-0.5 rounded`}>{item.status}</span>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}

                        {financeTab === 'salary' && (
                            <div className="bg-white p-6 rounded-lg border border-slate-200 shadow-sm">
                                <div className="text-center mb-6 border-b border-slate-100 pb-4">
                                    <p className="text-xs text-slate-500 uppercase font-bold">{t('Total Earnings')}</p>
                                    <h3 className="text-3xl font-bold text-slate-800 mt-1">‚Çπ{FINANCE_DATA.salary.total}</h3>
                                    <p className="text-xs text-slate-400 mt-1">{FINANCE_DATA.salary.month}</p>
                                </div>
                                <div className="space-y-3">
                                    <div className="flex justify-between items-center text-sm">
                                        <span className="text-slate-600">{t('Fixed Honorarium')}</span>
                                        <span className="font-bold text-slate-800">‚Çπ{FINANCE_DATA.salary.honorarium}</span>
                                    </div>
                                    <div className="flex justify-between items-center text-sm">
                                        <span className="text-slate-600">{t('Performance Incentives')}</span>
                                        <span className="font-bold text-emerald-600">+ ‚Çπ{FINANCE_DATA.salary.incentives}</span>
                                    </div>
                                </div>
                                <button className="w-full mt-6 flex items-center justify-center gap-2 bg-slate-100 text-slate-600 py-2 rounded-lg font-bold text-sm hover:bg-slate-200 active:scale-95 transition-transform duration-150">
                                    <DownloadCloud size={16}/> {t('Download Slip')}
                                </button>
                            </div>
                        )}

                        {financeTab === 'benefits' && (
                            <div className="space-y-3">
                                {FINANCE_DATA.benefits.map((b, i) => (
                                    <div key={i} className="bg-white p-4 rounded-lg border border-slate-200 shadow-sm flex items-center gap-3">
                                        <div className="bg-blue-50 p-2 rounded-full text-blue-600"><ShieldCheck size={20}/></div>
                                        <div className="flex-1">
                                            <h4 className="font-bold text-slate-800 text-sm">{b.name}</h4>
                                            <p className="text-xs text-slate-500">Renewal: {b.renewal}</p>
                                        </div>
                                        <span className="text-[10px] font-bold bg-emerald-50 text-emerald-600 px-2 py-1 rounded border border-emerald-100 uppercase">{b.status}</span>
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>
                </div>
            );
            
            const renderSafety = () => (
                <div className="h-full flex flex-col bg-slate-50 animate-in slide-in-from-right">
                    <div className="bg-rose-900 text-white p-6 pb-6">
                        <h2 className="text-xl font-bold mb-1 flex items-center gap-2"><ShieldAlert size={24}/> {t('ASHA Sahayata (Safety)')}</h2>
                        <p className="text-rose-200 text-xs">{t('Your safety is our priority.')}</p>
                    </div>

                    <div className="flex-1 overflow-y-auto p-4 space-y-6">
                        {/* Section 1: Emergency Helplines */}
                        <div>
                            <h3 className="text-xs font-bold text-slate-500 uppercase mb-3 px-1">{t('Emergency Dial')}</h3>
                            <div className="grid grid-cols-2 gap-3">
                                <button onClick={() => handleEmergencyCall("1090")} className="bg-white p-4 rounded-xl border-l-4 border-l-rose-500 shadow-sm flex flex-col items-center gap-2 hover:bg-rose-50 active:scale-95 transition-transform duration-150">
                                    <div className="bg-rose-100 p-3 rounded-full text-rose-600"><PhoneCall size={24}/></div>
                                    <div className="text-center">
                                        <span className="block font-bold text-slate-800">{t('Women Line')}</span>
                                        <span className="text-xs font-bold text-rose-600">1090</span>
                                    </div>
                                </button>
                                <button onClick={() => handleEmergencyCall("Medical Officer")} className="bg-white p-4 rounded-xl border-l-4 border-l-teal-600 shadow-sm flex flex-col items-center gap-2 hover:bg-teal-50 active:scale-95 transition-transform duration-150">
                                    <div className="bg-teal-100 p-3 rounded-full text-teal-600"><Stethoscope size={24}/></div>
                                    <div className="text-center">
                                        <span className="block font-bold text-slate-800">{t('Med. Officer')}</span>
                                        <span className="text-xs font-bold text-teal-600">{t('Call Now')}</span>
                                    </div>
                                </button>
                            </div>
                        </div>

                        {/* Section 2: Peer Network */}
                        <div>
                            <h3 className="text-xs font-bold text-slate-500 uppercase mb-3 px-1">{t('Peer Network (Buddy System)')}</h3>
                            <div className="bg-white rounded-lg border border-slate-200 overflow-hidden shadow-sm">
                                {PEER_NETWORK.map(peer => (
                                    <div key={peer.id} className="p-3 border-b border-slate-100 last:border-0 flex justify-between items-center">
                                        <div className="flex items-center gap-3">
                                            <div className="bg-indigo-50 p-2 rounded-full text-indigo-600 font-bold text-xs">{peer.name.substring(0,2)}</div>
                                            <div>
                                                <p className="text-sm font-bold text-slate-800">{peer.name}</p>
                                                <p className="text-[10px] text-slate-500">{peer.distance} ‚Ä¢ {peer.status}</p>
                                            </div>
                                        </div>
                                        <button onClick={() => handlePeerRequest(peer.name)} className="text-xs bg-slate-100 hover:bg-slate-200 text-slate-700 px-3 py-1.5 rounded-full font-bold active:scale-95 transition-transform">
                                            {t('Request Visit')}
                                        </button>
                                    </div>
                                ))}
                            </div>
                        </div>

                        {/* Section 3: Anonymous Reporting */}
                        <div className="bg-white p-4 rounded-lg border border-slate-200 shadow-sm">
                            <h3 className="text-sm font-bold text-slate-800 mb-2 flex items-center gap-2"><EyeOff size={16} className="text-slate-400"/> {t('Anonymous Reporting')}</h3>
                            <p className="text-xs text-slate-500 mb-3">Report harassment or safety issues securely. Your ID will not be shared.</p>
                            <textarea className="w-full bg-slate-50 border border-slate-200 rounded p-2 text-sm mb-3 focus:outline-none focus:border-rose-400" rows="3" placeholder="Describe the issue..."></textarea>
                            <button onClick={submitAnonymousReport} className="w-full bg-slate-800 text-white py-2 rounded text-sm font-bold hover:bg-slate-900 active:scale-95 transition-transform duration-150">{t('Submit Report')}</button>
                        </div>
                    </div>
                </div>
            );

            const renderReferral = () => (
                <div className="h-full flex flex-col bg-slate-50 animate-in zoom-in">
                    <div className="bg-rose-600 text-white p-6 pb-12 relative overflow-hidden">
                        <div className="absolute top-0 right-0 p-4 opacity-20"><Siren size={100}/></div>
                        <h2 className="text-2xl font-bold mb-1">{t('Emergency Referral')}</h2>
                        <p className="text-rose-100 text-sm">{t('High Risk Protocol Activated')}</p>
                    </div>

                    <div className="flex-1 p-6 -mt-8">
                        <div className="bg-white rounded-xl shadow-xl p-6 border border-slate-200 text-center space-y-6">
                            
                            <div className="border-b border-slate-100 pb-4">
                                <p className="text-xs font-bold text-slate-400 uppercase tracking-widest">{t('Referral ID')}</p>
                                <p className="text-3xl font-mono font-bold text-slate-800 mt-1">{referralId || "Generating..."}</p>
                            </div>

                            <div className="space-y-4">
                                {/* Ambulance Status */}
                                <div className={`p-4 rounded-lg border flex items-center gap-4 ${ambulanceStatus === 'connected' ? 'bg-emerald-50 border-emerald-200' : 'bg-slate-50 border-slate-200'}`}>
                                    <div className={`p-3 rounded-full ${ambulanceStatus === 'connected' ? 'bg-emerald-100 text-emerald-600' : 'bg-white text-slate-400 animate-pulse-red'}`}>
                                        <Ambulance size={24}/>
                                    </div>
                                    <div className="text-left flex-1">
                                        <p className="font-bold text-slate-800">108 Ambulance</p>
                                        <p className="text-xs text-slate-500">
                                            {ambulanceStatus === 'searching' ? t('Connecting to network...') : 
                                             ambulanceStatus === 'connected' ? t('Dispatch Confirmed (5 mins away)') : t('Waiting...')}
                                        </p>
                                    </div>
                                    {ambulanceStatus === 'connected' && <CheckCircle size={20} className="text-emerald-500"/>}
                                </div>

                                {/* PHC Alert */}
                                <div className="p-4 rounded-lg border border-indigo-200 bg-indigo-50 flex items-center gap-4">
                                    <div className="p-3 rounded-full bg-indigo-100 text-indigo-600">
                                        <HospitalIcon size={24}/>
                                    </div>
                                    <div className="text-left flex-1">
                                        <p className="font-bold text-indigo-900">{t('PHC Alerted')}</p>
                                        <p className="text-xs text-indigo-700">Dr. Sharma has been notified.</p>
                                    </div>
                                    <CheckCircle size={20} className="text-indigo-500"/>
                                </div>
                            </div>
                            
                            <div className="pt-4">
                                <p className="text-xs text-slate-400 mb-4">Show this screen to the ambulance driver.</p>
                                <button onClick={() => setScreen('home')} className="w-full py-3 border border-slate-300 rounded-lg text-slate-600 font-bold hover:bg-slate-50 active:scale-95 transition-transform duration-150">{t('Back to Home')}</button>
                            </div>
                        </div>
                    </div>
                </div>
            );
            
            // Icon helper for referral
            const HospitalIcon = ({size}) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 6v4"/><path d="M14 14h-4"/><path d="M14 18h-4"/><path d="M14 8h-4"/><path d="M18 12h-6"/><path d="M6 12h6"/><path d="M3 21h18"/><path d="M5 21V7a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v14"/></svg>
            );

            const renderRegistration = () => (
                <div className="p-4 space-y-4 animate-in slide-in-from-right">
                    <div className="flex justify-between items-center">
                         <h2 className="text-xl font-bold text-slate-800">{t('New Registration')}</h2>
                         <button onClick={() => setShowQr(true)} className="text-teal-600 flex items-center gap-1 text-sm font-bold bg-teal-50 px-3 py-1.5 rounded-full border border-teal-200 active:scale-95 transition-transform"><Scan size={16}/> {t('Scan QR')}</button>
                    </div>
                    
                    {/* Auto-Population Banner */}
                    <div className="bg-indigo-50 border border-indigo-200 p-3 rounded-lg flex gap-3 items-start">
                        <div className="bg-indigo-100 p-1.5 rounded-full text-indigo-600 mt-0.5"><Database size={14}/></div>
                        <div>
                            <p className="text-xs font-bold text-indigo-800 uppercase">{t('Single Source Data')}</p>
                            <p className="text-xs text-indigo-600 leading-tight mt-0.5">This entry will automatically populate the ANC Register, Immunization Log, and Eligible Couple list.</p>
                        </div>
                    </div>

                    <div className="bg-white p-6 rounded-lg border border-slate-200 shadow-sm space-y-4">
                        <div>
                            <label className="text-xs font-bold text-slate-500 uppercase">{t('Full Name')}</label>
                            <input value={newReg.name} onChange={e=>setNewReg({...newReg, name: e.target.value})} className="w-full border-b border-slate-300 py-2 outline-none focus:border-teal-600" placeholder="e.g. Anjali Gupta"/>
                        </div>
                        <div className="grid grid-cols-2 gap-4">
                            <div>
                                <label className="text-xs font-bold text-slate-500 uppercase">{t('Age')}</label>
                                <input type="number" value={newReg.age} onChange={e=>setNewReg({...newReg, age: e.target.value})} className="w-full border-b border-slate-300 py-2 outline-none focus:border-teal-600" placeholder="Years"/>
                            </div>
                            <div>
                                <label className="text-xs font-bold text-slate-500 uppercase">{t('Weeks')}</label>
                                <input type="number" value={newReg.weeks} onChange={e=>setNewReg({...newReg, weeks: e.target.value})} className="w-full border-b border-slate-300 py-2 outline-none focus:border-teal-600" placeholder="Gest. Age"/>
                            </div>
                        </div>
                        <div>
                            <label className="text-xs font-bold text-slate-500 uppercase">{t('Phone')}</label>
                            <input type="tel" value={newReg.phone} onChange={e=>setNewReg({...newReg, phone: e.target.value})} className="w-full border-b border-slate-300 py-2 outline-none focus:border-teal-600" placeholder="Mobile Number"/>
                        </div>
                        <div>
                            <label className="text-xs font-bold text-slate-500 uppercase">{t('Village')}</label>
                            <input value={newReg.village} onChange={e=>setNewReg({...newReg, village: e.target.value})} className="w-full border-b border-slate-300 py-2 outline-none focus:border-teal-600" placeholder="Village Name"/>
                        </div>
                        
                        {/* Smart Vitals Sync */}
                        <div className="pt-2 border-t border-slate-100">
                             <div className="flex justify-between items-center mb-2">
                                <span className="text-xs font-bold text-slate-500 uppercase">{t('Vitals')}</span>
                                <button onClick={handleBluetoothSync} disabled={isSyncing} className="flex items-center gap-1 text-[10px] font-bold bg-blue-50 text-blue-600 px-2 py-1 rounded border border-blue-200 active:scale-95 transition-transform duration-150">
                                    {isSyncing ? <span className="animate-spin mr-1">C</span> : <Bluetooth size={12}/>}
                                    {isSyncing ? "Syncing..." : t('Sync Device')}
                                </button>
                             </div>
                             <div className="grid grid-cols-2 gap-4">
                                <input value={newReg.bp} onChange={e=>setNewReg({...newReg, bp: e.target.value})} className="w-full border-b border-slate-300 py-2 outline-none text-sm" placeholder="BP (mmHg)"/>
                                <input value={newReg.weight} onChange={e=>setNewReg({...newReg, weight: e.target.value})} className="w-full border-b border-slate-300 py-2 outline-none text-sm" placeholder="Weight (kg)"/>
                             </div>
                        </div>

                        <button onClick={handleRegister} className="w-full bg-teal-700 text-white py-3 rounded-lg font-bold mt-4 hover:bg-teal-800 flex items-center justify-center gap-2 active:scale-95 transition-transform duration-150">
                            <Save size={18}/> {t('Save & Sync')}
                        </button>
                    </div>
                </div>
            );

            const renderPatientDetail = () => {
                const m = selectedMother;
                return (
                    <div className="bg-slate-50 min-h-screen pb-20 animate-in slide-in-from-right">
                        {/* Profile Header */}
                        <div className="bg-white p-6 border-b border-slate-200">
                            <div className="flex justify-between items-start">
                                <div>
                                    <h2 className="text-2xl font-bold text-slate-800">{m.name}</h2>
                                    <p className="text-sm text-slate-500 flex items-center gap-1"><MapPin size={12}/> {m.village}</p>
                                </div>
                                <button onClick={sendSmsReminder} className="p-2 bg-indigo-50 text-indigo-600 rounded-full border border-indigo-200 active:scale-95 transition-transform">
                                    <MessageCircle size={20}/>
                                </button>
                            </div>
                            
                            <div className="grid grid-cols-2 gap-2 mt-4">
                                <div className="bg-slate-50 p-2 rounded border border-slate-100">
                                    <p className="text-[10px] text-slate-400 uppercase font-bold">{t('Obstetric History')}</p>
                                    <p className="text-sm font-semibold text-slate-700">{m.history}</p>
                                </div>
                                <div className="bg-slate-50 p-2 rounded border border-slate-100">
                                    <p className="text-[10px] text-slate-400 uppercase font-bold">LMP / EDD</p>
                                    <p className="text-sm font-semibold text-slate-700">{m.lmp || 'N/A'} / {m.edd ? m.edd.substring(0,4) : 'N/A'}</p>
                                </div>
                            </div>
                        </div>

                        {/* Analytics & Charts */}
                        {m.hbHistory && (
                            <div className="p-4 pb-0">
                                <SimpleLineChart data={m.hbHistory} t={t} />
                            </div>
                        )}

                        {/* Vital Grid */}
                        <div className="grid grid-cols-3 gap-px bg-slate-200 border-y border-slate-200 mt-4">
                            <div className="bg-white p-4 text-center">
                                <p className="text-[10px] uppercase font-bold text-slate-400">BP</p>
                                <p className="text-lg font-semibold text-slate-800">{m.bp}</p>
                            </div>
                            <div className="bg-white p-4 text-center">
                                <p className="text-[10px] uppercase font-bold text-slate-400">Hb</p>
                                <p className={`text-lg font-semibold ${Number(m.hemoglobin) < 11 ? 'text-rose-600' : 'text-slate-800'}`}>{m.hemoglobin}</p>
                            </div>
                            <div className="bg-white p-4 text-center">
                                <p className="text-[10px] uppercase font-bold text-slate-400">Weight</p>
                                <p className="text-lg font-semibold text-slate-800">{m.weight}</p>
                            </div>
                        </div>

                        {/* Counseling Tools (Job Aids) */}
                        <div className="p-4 space-y-4">
                            <h3 className="text-xs font-bold text-slate-500 uppercase px-1">{t('Counseling & Job Aids')}</h3>
                            <div className="bg-white rounded-lg border border-slate-200 overflow-hidden">
                                {JOB_AIDS.map((aid) => (
                                    <div key={aid.id} className="p-3 border-b border-slate-100 last:border-0 flex justify-between items-center">
                                        <div className="flex items-center gap-3">
                                            <div className="w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center text-slate-500">
                                                {aid.type === 'Audio' ? <Volume2 size={18}/> : aid.type === 'Video' ? <Video size={18}/> : <ClipboardList size={18}/>}
                                            </div>
                                            <div>
                                                <p className="text-sm font-bold text-slate-800">{aid.title}</p>
                                                <p className="text-xs text-slate-500">{aid.desc}</p>
                                            </div>
                                        </div>
                                        <button className="text-teal-700 bg-teal-50 p-2 rounded-full hover:bg-teal-100">
                                            <PlayCircle size={20}/>
                                        </button>
                                    </div>
                                ))}
                            </div>
                        </div>

                        {/* Actions */}
                        <div className="p-4 space-y-3 pt-0">
                            <button onClick={() => setScreen('asdt')} className="w-full bg-slate-800 text-white py-3 rounded-lg font-semibold shadow-md flex items-center justify-center gap-2 active:scale-95 transition-transform duration-150">
                                <Stethoscope size={18}/> {t('Start Checkup')}
                            </button>
                            <button onClick={initiateReferral} className="w-full bg-rose-50 text-rose-700 border border-rose-200 py-3 rounded-lg font-semibold flex items-center justify-center gap-2 active:scale-95 transition-transform duration-150">
                                <Siren size={18}/> {t('Emergency Referral')}
                            </button>
                        </div>
                    </div>
                );
            };

            const renderASDT = () => (
                <div className="h-full flex flex-col relative bg-black">
                    {/* Fake Camera Viewfinder */}
                    <div className="absolute inset-0 bg-slate-800 camera-overlay flex items-center justify-center">
                         {/* This simulates the camera feed */}
                         <p className="text-white/50 text-sm font-medium mt-40 bg-black/50 px-3 py-1 rounded-full backdrop-blur-sm">Align tongue in box</p>
                    </div>
                    
                    <div className="absolute top-0 left-0 w-full p-4 z-10">
                        <div className="flex justify-between items-center text-white">
                            <button onClick={() => setScreen('patient_detail')}><X/></button>
                            <span className="font-bold">A-SDT Scanner</span>
                            <Info size={20}/>
                        </div>
                    </div>

                    <div className="absolute bottom-0 left-0 w-full bg-slate-900/90 rounded-t-2xl p-6 z-20 backdrop-blur-md">
                        <h2 className="text-white font-bold mb-4 text-center text-sm uppercase tracking-widest">Match Color to Palette</h2>
                        <div className="grid grid-cols-5 gap-2">
                            {ANAEMIA_SCALE.map((scale) => (
                                <button 
                                    key={scale.id}
                                    onClick={() => { setAsdtColor(scale.id); setQIndex(0); setSymptoms({}); setScreen('symptoms'); }}
                                    className="flex flex-col items-center gap-1 group active:scale-95 transition-transform"
                                >
                                    <div 
                                        className="w-full aspect-square rounded-lg border-2 border-transparent group-hover:scale-110 group-active:scale-95 transition-all shadow-lg"
                                        style={{ backgroundColor: scale.color, borderColor: scale.textColor }}
                                    ></div>
                                    <span className="text-[10px] text-white font-bold">{scale.label.split(' ')[1]}</span>
                                </button>
                            ))}
                        </div>
                    </div>
                </div>
            );

            const renderSymptoms = () => {
                const q = SYMPTOM_CHECKLIST[qIndex];
                return (
                    <div className="p-6 h-full flex flex-col animate-in slide-in-from-right">
                        <div className="w-full bg-slate-200 h-2 rounded-full mb-8">
                            <div className="bg-teal-600 h-2 rounded-full transition-all duration-300" style={{ width: `${((qIndex + 1) / SYMPTOM_CHECKLIST.length) * 100}%` }}></div>
                        </div>
                        <div className="flex-1 flex flex-col items-center justify-center text-center">
                            <div className="w-32 h-32 bg-slate-100 rounded-full flex items-center justify-center mb-6 border-4 border-slate-200">
                                <div className="text-6xl">{q.icon}</div>
                            </div>
                            <h3 className="text-xl font-bold text-slate-800 mb-2">{lang === 'hi' ? q.hi : q.en}</h3>
                            
                            {/* ThinkLet Guide */}
                            <div className="mt-6 bg-amber-50 border border-amber-200 p-4 rounded-xl relative w-full">
                                <div className="absolute -top-3 left-4 bg-amber-100 text-amber-800 text-[10px] font-bold px-2 py-1 rounded-full uppercase tracking-wider border border-amber-200">
                                    ThinkLet Guide
                                </div>
                                <div className="flex gap-3">
                                    <div className="mt-0.5 text-amber-600"><Lightbulb size={18} /></div>
                                    <p className="text-sm text-slate-700 font-medium leading-relaxed text-left">{q.guide}</p>
                                </div>
                            </div>
                        </div>
                        <div className="grid grid-cols-2 gap-4 mt-8">
                            <button onClick={() => handleSymptomAnswer(false)} className="bg-white border-2 border-slate-200 text-slate-700 py-4 rounded-xl font-bold flex flex-col items-center gap-1 hover:bg-slate-50 active:scale-95 transition-transform duration-150">
                                <X className="text-slate-400"/> No
                            </button>
                            <button onClick={() => handleSymptomAnswer(true)} className="bg-teal-600 text-white py-4 rounded-xl font-bold shadow-lg shadow-teal-200 flex flex-col items-center gap-1 hover:bg-teal-700 active:scale-95 transition-transform duration-150">
                                <Check/> Yes
                            </button>
                        </div>
                    </div>
                );
            };

            const renderResult = () => {
                const config = {
                    GREEN: { color: 'bg-emerald-500', text: 'NORMAL', icon: <Check size={48}/>, action: 'Routine Care' },
                    YELLOW: { color: 'bg-yellow-400', text: 'MODERATE', icon: <Activity size={48}/>, action: 'Follow up in 1 week' },
                    ORANGE: { color: 'bg-orange-500', text: 'HIGH RISK', icon: <AlertTriangle size={48}/>, action: 'Visit PHC in 3 days' },
                    RED: { color: 'bg-rose-600', text: 'DANGER', icon: <Siren size={48}/>, action: 'IMMEDIATE HOSPITAL' }
                }[riskLevel];

                return (
                    <div className="p-6 h-full flex flex-col items-center text-center animate-in zoom-in">
                        <div className={`${config.color} text-white w-40 h-40 rounded-full flex flex-col items-center justify-center shadow-xl mb-6 ring-8 ring-slate-100`}>
                            {config.icon}
                            <div className="font-bold text-xl mt-1">{config.text}</div>
                        </div>
                        <div className="w-full bg-white p-6 rounded-xl border border-slate-200 shadow-lg text-left mb-6 relative overflow-hidden">
                            <div className={`absolute top-0 left-0 w-1.5 h-full ${config.color}`}></div>
                            <h4 className="font-bold text-slate-500 text-xs uppercase mb-2">{t('Algorithm Recommendation')}</h4>
                            <p className="font-bold text-slate-800 text-xl">{config.action}</p>
                            <div className="mt-4 pt-4 border-t border-slate-100 flex gap-2 items-center text-xs text-slate-500">
                                <Settings size={12}/> AI Risk Score: {riskScore}/100
                            </div>
                        </div>
                        
                        {/* Credential Multiplier Button */}
                        <button onClick={() => setShowDoctorModal(true)} className="w-full bg-indigo-600 text-white py-4 rounded-lg font-bold mb-3 flex items-center justify-center gap-2 shadow-lg shadow-indigo-200 hover:bg-indigo-700 active:scale-95 transition-transform duration-150">
                            <UserCircle size={20} /> {t('Play Doctor\'s Message')}
                        </button>

                        <button onClick={() => setScreen('home')} className="w-full bg-slate-900 text-white py-4 rounded-lg font-bold active:scale-95 transition-transform duration-150">{t('Save Assessment')}</button>
                    </div>
                );
            };

            const renderProfile = () => (
                 <div className="p-4 space-y-4 animate-in slide-in-from-left">
                    <div className="bg-white p-6 rounded-lg border border-slate-200 shadow-sm flex items-center gap-4">
                        <div className="w-16 h-16 bg-slate-100 rounded-full flex items-center justify-center"><UserCircle size={40} className="text-slate-400"/></div>
                        <div>
                            <h2 className="text-xl font-bold text-slate-800">Rekha Singh</h2>
                            <p className="text-sm text-slate-500">ASHA Worker ‚Ä¢ ID: ASH-101</p>
                        </div>
                    </div>
                    <div className="bg-white rounded-lg border border-slate-200 overflow-hidden">
                        {[
                            {icon: <Wallet size={18}/>, label: "My Earnings & Benefits", action: () => setScreen('finance')},
                            {icon: <ShieldAlert size={18}/>, label: "ASHA Sahayata (Safety)", action: () => setScreen('safety')},
                            {icon: <LayoutDashboard size={18}/>, label: "Performance Report"},
                            {icon: <Settings size={18}/>, label: "Settings"},
                            {icon: <LogOut size={18}/>, label: "Logout", action: () => setScreen('login')}
                        ].map((item, i) => (
                            <button key={i} onClick={item.action} className="w-full p-4 flex items-center gap-3 hover:bg-slate-50 border-b border-slate-100 last:border-0 text-slate-700 active:bg-slate-50 transition-colors">
                                {item.icon} {t(item.label)}
                            </button>
                        ))}
                    </div>
                    {/* Sidebar Branding */}
                    <div className="mt-8 text-center opacity-50">
                        <div className="flex justify-center items-center gap-2 mb-1">
                            <Landmark size={20} className="text-slate-400" />
                            <span className="text-[10px] font-bold text-slate-500 uppercase tracking-widest">{t('National Health Mission')}</span>
                        </div>
                        <p className="text-[8px] text-slate-400 font-medium">{t('Digital India')} Initiative</p>
                    </div>
                 </div>
            );

            // --- MAIN RETURN ---
            const isAuth = screen === 'login' || screen === 'splash' || screen === 'forgot_pin';
            
            return (
                <div className="max-w-md mx-auto h-screen bg-slate-50 flex flex-col relative shadow-2xl border-x border-slate-200">
                    {!isAuth && (
                        <Header 
                            title={
                                screen === 'home' ? 'Dashboard' : 
                                screen === 'patient_detail' ? 'Patient Profile' : 
                                screen === 'finance' ? 'Finance Hub' : 
                                screen === 'safety' ? 'Safety Hub' :
                                screen === 'referral' ? 'Referral' :
                                'Sanraksha'
                            } 
                            backAction={screen !== 'home' ? () => setScreen('home') : null}
                            onMenuClick={() => setScreen('profile')}
                        />
                    )}
                    
                    <div className="flex-1 overflow-y-auto no-scrollbar">
                        {screen === 'splash' && (
                             <div className="h-full flex flex-col items-center justify-center bg-slate-900 text-white">
                                <ShieldCheck size={64} className="text-teal-500 animate-pulse mb-4"/>
                                <h1 className="text-3xl font-bold tracking-tight">Sanraksha</h1>
                                <p className="text-slate-400 text-sm tracking-widest mt-2 uppercase">Professional Care System</p>
                                <div className="absolute bottom-10 flex flex-col items-center opacity-70">
                                    <Landmark size={24} className="mb-2"/>
                                    <p className="text-[10px] font-bold uppercase tracking-widest">{t('National Health Mission')}</p>
                                </div>
                            </div>
                        )}
                        {screen === 'login' && renderLogin()}
                        {screen === 'forgot_pin' && renderForgotPin()}
                        {screen === 'home' && renderHome()}
                        {screen === 'inventory' && renderInventory()}
                        {screen === 'training' && renderTraining()}
                        {screen === 'finance' && renderFinance()}
                        {screen === 'safety' && renderSafety()}
                        {screen === 'referral' && renderReferral()}
                        {screen === 'registration' && renderRegistration()}
                        {screen === 'patient_detail' && renderPatientDetail()}
                        {screen === 'asdt' && renderASDT()}
                        {screen === 'symptoms' && renderSymptoms()}
                        {screen === 'result' && renderResult()}
                        {screen === 'profile' && renderProfile()}
                    </div>

                    <NotificationCenter 
                        isOpen={showNotifications} 
                        onClose={() => setShowNotifications(false)} 
                        notifications={notifications}
                        clearAll={() => setNotifications([])}
                        t={t}
                    />

                    {!isAuth && (
                        <div className="absolute bottom-6 right-6 z-30">
                            <button onClick={() => setShowChat(true)} className="bg-slate-800 text-white p-3.5 rounded-full shadow-lg hover:bg-slate-700 border border-slate-700 transition-all hover:scale-110 animate-float">
                                <Sparkles size={24} className="text-teal-400"/>
                            </button>
                        </div>
                    )}
                    <AskDidiModal isOpen={showChat} onClose={() => setShowChat(false)} lang={lang} />
                    <DoctorAudioModal isOpen={showDoctorModal} onClose={() => setShowDoctorModal(false)} riskLevel={riskLevel} />
                    <QrScannerModal isOpen={showQr} onClose={() => setShowQr(false)} onScan={handleQrScan} />
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<SanrakshaApp />);
    </script>
</body>
</html>